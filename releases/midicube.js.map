{"version":3,"sources":["webpack://MIDI/webpack/universalModuleDefinition","webpack://MIDI/webpack/bootstrap","webpack://MIDI/./js/shim/WebAudioAPI.js","webpack://MIDI/./js/audioDetect.js","webpack://MIDI/./js/gm.js","webpack://MIDI/./js/plugin.audiotag.js","webpack://MIDI/./js/shim/Base64binary.js","webpack://MIDI/./js/plugin.webaudio.js","webpack://MIDI/./js/plugin.webmidi.js","webpack://MIDI/./inc/jasmid/stream.js","webpack://MIDI/./inc/jasmid/midifile.js","webpack://MIDI/./inc/jasmid/replayer.js","webpack://MIDI/./js/player.js","webpack://MIDI/./js/synesthesia.js","webpack://MIDI/./js/index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Context","proto","instance","sourceProto","isFunction","AudioContext","webkitAudioContext","OfflineAudioContext","webkitOfflineAudioContext","f","toString","destination","sampleRate","getPrototypeOf","createBufferSource","start","noteOn","when","offset","duration","arguments","length","Error","this","buffer","noteGrainOn","stop","noteOff","forEach","names","name1","name2","pop","supports","pending","canPlayThrough","src","body","document","audio","Audio","mime","split","id","setAttribute","addEventListener","removeChild","appendChild","GM","in_dict","asId","replace","toLowerCase","res","byName","byId","byCategory","_i","_Object$entries","entries","_Object$entries$_i","_slicedToArray","list","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","iterator","next","done","instrument","parseInt","substr","indexOf","programNumber","nameId","categoryId","spec","program","category","push","err","GM_fixer","Piano","Chromatic Percussion","Organ","Guitar","Bass","Strings","Ensemble","Brass","Reed","Pipe","Synth Lead","Synth Pad","Synth Effects","Ethnic","Percussive","Sound effects","channels","pitchBend","mute","mono","omni","solo","get_channels","keyToNote","noteToKey","number2key","shared_root_info","volumes","vid","buffer_nid","notesOn","notes","audioBuffers","nid","playChannel","channel","in_note","instrumentId","note","instrumentNoteId","Soundfont","console","log","volume","play","stopChannel","len","cId","pause","send","data","delay","setController","type","setVolume","programChange","velocity","setTimeout","chordOn","chord","_loop","idx","v","_ret","_typeof","chordOff","_loop2","_ret2","stopAllNotes","connect","opts","onsuccess","_keyStr","decodeArrayBuffer","input","bytes","Math","ceil","ab","ArrayBuffer","arrayBuffer","uarray","chr1","chr2","chr3","enc1","enc2","enc3","enc4","lkey1","charAt","lkey2","j","Uint8Array","decode","ctx","sources","effects","masterVolume","channelId","bend","noteId","source","currentTime","chain","gain","playbackRate","gainNode","createGain","min","max","linearRampToValueAtTime","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","sid","setEffects","tunajs","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","effect","setContext","createAudioContext","getContext","newCtx","onprogress","onerror","Tuna","urls","waitForEnd","_Object$keys","keys","bufferPending","requestAudio","soundfont","programId","index","url","loadAudio","percent","isLoaded","_i2","plugin_webaudio_slicedToArray","Base64Binary","decodeAudioData","request","XMLHttpRequest","open","responseType","response","output","cancel","errFunction","error","webaudio_backup_connect","config","api","navigator","requestMIDIAccess","then","access","pluginOutputs","outputs","Stream","str","_classCallCheck","position","result","charCodeAt","signed","b","readInt8","MidiFileClass","midifile_classCallCheck","stream","lastEventTypeByte","read","readInt32","event","deltaTime","readVarInt","eventTypeByte","subtypeByte","subtype","number","readInt16","text","microsecondsPerBeat","hourByte","frameRate","0","32","64","96","hour","sec","frame","subframe","numerator","denominator","pow","metronome","thirtyseconds","scale","param1","eventType","noteNumber","amount","controllerType","headerChunk","readChunk","headerStream","formatType","trackCount","timeDivision","header","ticksPerBeat","tracks","trackChunk","trackStream","eof","readEvent","Replayer","midiFile","timeWarp","eventProcessor","bpm","replayer_classCallCheck","trackStates","beatsPerMinute","bpmOverride","nextEventIndex","ticksToNextEvent","temporal","processEvents","nextEventTrack","nextEvent","ticksToEvent","track","midiEvent","getNextEvent","secondsToGenerate","time","clone","replayer_typeof","ret","PlayInstance","plugin","player_classCallCheck","endTime","restart","playing","startDelay","BPM","eventQueue","queuedTime","startTime","noteRegistrar","onMidiEvent","__now","startAudio","tmp","stopAudio","animationFrameId","cancelAnimationFrame","mthis","callback","_this","tOurTime","tTheirTime","clearAnimation","requestAnimationFrame","Date","now","total","minutes","t1","t2","end","events","replayer","currentData","parseAndReturn","getData","getLength","loadPlugin","file","_this2","atob","loadMidiFile","fetch","overrideMimeType","onreadystatechange","readyState","status","responseText","ff","mx","scc","String","fromCharCode","z","join","instruments","programs","midi","isFinite","message","_this3","shift","MIDI","WebAudio","totalTime","performance","fromCache","messages","interval","foffset","getNow","obj","queueTime","MIDIOffset","scheduleTracking","clearInterval","clearTimeout","disconnect","Isaac Newton (1704)","format","ref","english","1","2","3","4","5","6","7","8","9","10","11","Louis Bertrand Castel (1734)","George Field (1816)","D. D. Jameson (1844)","Theodor Seemann (1881)","A. Wallace Rimington (1893)","Bainbridge Bishop (1893)","H. von Helmholtz (1910)","Alexander Scriabin (1911)","Adrian Bernard Klein (1930)","August Aeppli (1940)","I. J. Belmont (1944)","Steve Zieverink (2004)","Circle of Fifths (Johnston 2003)","Circle of Fifths (Wheatman 2002)","map","H","S","L","a","data_internal","syn","colors","prior_clr","hsl","hex","clr","Color","Space","audio_contexts","AudioTag","WebMIDI","soundfontUrl","audioFormat","connected_plugin","targetFormat","apiPrecedence","successCallback","Function","plugins","_Array$from","Array","from","canPlayType","vorbis","mpeg","getTime","setInterval","audioDetect","hash","location","apiInOrder","loadProgram","js_typeof","webmidi","pre_connect","audiotag","requestQueue","webaudio","context","correct_audio_context","num_instruments","sendRequest","evt","progress","soundfontPath","xhr","setRequestHeader","onload","script","createElement","language","_config$connected_plu","apply","_config$connected_plu2","_config$connected_plu3","_config$connected_plu4","_config$connected_plu5","_config$connected_plu6","_config$connected_plu7","_config$connected_plu8","_config$connected_plu9","_config$connected_plu10","_config$connected_plu11","_config$connected_plu12","_config$connected_plu13","Player","_PlayInstance","js_classCallCheck","_possibleConstructorReturn","_getPrototypeOf","_inherits"],"mappings":"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","file":"midicube.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"MIDI\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MIDI\"] = factory();\n\telse\n\t\troot[\"MIDI\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","/**\n * @license -------------------------------------------------------------------\n *   module: WebAudioShim - Fix naming issues for WebAudioAPI supports\n *      src: https://github.com/Dinahmoe/webaudioshim\n *   author: Dinahmoe AB\n * -------------------------------------------------------------------\n * Copyright (c) 2012 DinahMoe AB\n * \n * Permission is hereby granted, free of charge, to any person\n * obtaining a copy of this software and associated documentation\n * files (the \"Software\"), to deal in the Software without\n * restriction, including without limitation the rights to use,\n * copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the\n * Software is furnished to do so, subject to the following\n * conditions:\n * \n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n * OTHER DEALINGS IN THE SOFTWARE.\n */\n\nwindow.AudioContext = window.AudioContext || window.webkitAudioContext || null;\nwindow.OfflineAudioContext = window.OfflineAudioContext || window.webkitOfflineAudioContext || null;\n\n(function (Context) {\n\tvar isFunction = function (f) {\n\t\treturn Object.prototype.toString.call(f) === \"[object Function]\" ||\n\t\t\tObject.prototype.toString.call(f) === \"[object AudioContextConstructor]\";\n\t};\n\tvar contextMethods = [\n\t\t[\"createGainNode\", \"createGain\"],\n\t\t[\"createDelayNode\", \"createDelay\"],\n\t\t[\"createJavaScriptNode\", \"createScriptProcessor\"]\n\t];\n\t//\n\tvar proto;\n\tvar instance;\n\tvar sourceProto;\n\t//\n\tif (!isFunction(Context)) {\n\t\treturn;\n\t}\n\tinstance = new Context();\n\tif (!instance.destination || !instance.sampleRate) {\n\t\treturn;\n\t}\n\tproto = Context.prototype;\n\tsourceProto = Object.getPrototypeOf(instance.createBufferSource());\n\n\tif (!isFunction(sourceProto.start)) {\n\t\tif (isFunction(sourceProto.noteOn)) {\n\t\t\tsourceProto.start = function (when, offset, duration) {\n\t\t\t\tswitch (arguments.length) {\n\t\t\t\t\tcase 0:\n\t\t\t\t\t\tthrow new Error(\"Not enough arguments.\");\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tthis.noteOn(when);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\t\tif (this.buffer) {\n\t\t\t\t\t\t\tthis.noteGrainOn(when, offset, this.buffer.duration - offset);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(\"Missing AudioBuffer\");\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 3:\n\t\t\t\t\t\tthis.noteGrainOn(when, offset, duration);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tif (!isFunction(sourceProto.noteOn)) {\n\t\tsourceProto.noteOn = sourceProto.start;\n\t}\n\n\tif (!isFunction(sourceProto.noteGrainOn)) {\n\t\tsourceProto.noteGrainOn = sourceProto.start;\n\t}\n\n\tif (!isFunction(sourceProto.stop)) {\n\t\tsourceProto.stop = sourceProto.noteOff;\n\t}\n\n\tif (!isFunction(sourceProto.noteOff)) {\n\t\tsourceProto.noteOff = sourceProto.stop;\n\t}\n\n\tcontextMethods.forEach(function (names) {\n\t\tvar name1;\n\t\tvar name2;\n\t\twhile (names.length) {\n\t\t\tname1 = names.pop();\n\t\t\tif (isFunction(this[name1])) {\n\t\t\t\tthis[names.pop()] = this[name1];\n\t\t\t} else {\n\t\t\t\tname2 = names.pop();\n\t\t\t\tthis[name1] = this[name2];\n\t\t\t}\n\t\t}\n\t}, proto);\n})(window.AudioContext);\n","/*\n\t----------------------------------------------------------\n\tMIDI.audioDetect : 0.3.2 : 2015-03-26\n\t----------------------------------------------------------\n\thttps://github.com/mudcube/MIDI.js\n\t----------------------------------------------------------\n\tProbably, Maybe, No... Absolutely!\n\tTest to see what types of <audio> MIME types are playable by the browser.\n\t----------------------------------------------------------\n*/\n\nexport const supports = {}; // object of supported file types\n\nlet pending = 0; // pending file types to process\n\nexport const canPlayThrough = src => { // check whether format plays through\n\tpending += 1;\n\tconst body = document.body;\n\tconst audio = new Audio();\n\tconst mime = src.split(';')[0];\n\taudio.id = 'audio';\n\taudio.setAttribute('preload', 'auto');\n\taudio.setAttribute('audiobuffer', true);\n\taudio.addEventListener('error', () => {\n\t\tbody.removeChild(audio);\n\t\tsupports[mime] = false;\n\t\tpending -= 1;\n\t}, false);\n\taudio.addEventListener('canplaythrough', () => {\n\t\tbody.removeChild(audio);\n\t\tsupports[mime] = true;\n\t\tpending -= 1;\n\t}, false);\n\taudio.src = 'data:' + src;\n\tbody.appendChild(audio);\n};\n\nexport function audioDetect(successCallback) {\n\t// detect jazz-midi plugin\n\tif (typeof navigator !== 'undefined' && navigator.requestMIDIAccess) {\n\t\tconst isNative = Function.prototype.toString\n\t\t\t.call(navigator.requestMIDIAccess)\n\t\t\t.indexOf('[native code]');\n\n\t\tif (isNative) { // has native midiapi support\n\t\t\tsupports['webmidi'] = true;\n\t\t} else if (typeof navigator !== 'undefined' && navigator.plugins !== undefined) {\n\t\t\t// check for jazz plugin midiapi support\n\t\t\tfor (const plugin of Array.from(navigator.plugins)) {\n\t\t\t\tif (plugin.name.indexOf('Jazz-Plugin') >= 0) {\n\t\t\t\t\tsupports['webmidi'] = true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// check whether <audio> tag is supported\n\tif (typeof(Audio) === 'undefined') {\n\t\treturn successCallback({});\n\t} else {\n\t\tsupports['audiotag'] = true;\n\t}\n\n\t// check for webaudio api support\n\tif (window.AudioContext || window.webkitAudioContext) {\n\t\tsupports['webaudio'] = true;\n\t}\n\n\t// check whether canPlayType is supported\n\tconst audio = new Audio();\n\tif (typeof(audio.canPlayType) === 'undefined') {\n\t\treturn successCallback(supports);\n\t}\n\n\t// see what we can learn from the browser\n\tlet vorbis = audio.canPlayType('audio/ogg; codecs=\"vorbis\"');\n\tvorbis = (vorbis === 'probably' || vorbis === 'maybe');\n\tlet mpeg = audio.canPlayType('audio/mpeg');\n\tmpeg = (mpeg === 'probably' || mpeg === 'maybe');\n\t// maybe nothing is supported\n\tif (!vorbis && !mpeg) {\n\t\tsuccessCallback(supports);\n\t\treturn;\n\t}\n\n\t// or maybe something is supported\n\tif (vorbis) {\n\t\tcanPlayThrough('audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA=');\n\t}\n\tif (mpeg) {\n\t\tcanPlayThrough('audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq');\n\t}\n\t\t\n\t// lets find out!\n\tconst time = (new Date()).getTime();\n\tconst interval = window.setInterval(() => {\n\t\tconst now = (new Date()).getTime();\n\t\tconst maxExecution = now - time > 5000;\n\t\tif (!pending || maxExecution) {\n\t\t\twindow.clearInterval(interval);\n\t\t\tsuccessCallback(supports);\n\t\t}\n\t}, 1);\n};\n","/*\n----------------------------------------------------------\nGeneralMIDI\n----------------------------------------------------------\n*/\n\nconst GM_fixer = in_dict => {\n\tconst asId = name => {\n\t\treturn name.replace(/[^a-z0-9 ]/gi, '').replace(/[ ]/g, '_').toLowerCase();\n\t};\n\tconst res = {\n\t\tbyName: { },\n\t\tbyId: { },\n\t\tbyCategory: { }\n\t};\n\tfor (let [key, list] of Object.entries(in_dict)) {\n\t\tfor (let instrument of list) {\n\t\t\tif (!instrument) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst id = parseInt(instrument.substr(0, instrument.indexOf(' ')), 10);\n\t\t\tconst programNumber = id - 1;\n\t\t\tconst name = instrument.replace(id + ' ', '');\n\t\t\tconst nameId = asId(name);\n\t\t\tconst categoryId = asId(key);\n\t\t\tconst spec = {\n\t\t\t\tid: nameId,\n\t\t\t\tname: name,\n\t\t\t\tprogram: programNumber,\n\t\t\t\tcategory: key\n\t\t\t};\n\t\t\tres.byId[programNumber] = spec;\n\t\t\tres.byName[nameId] = spec;\n\t\t\tres.byCategory[categoryId] = res.byCategory[categoryId] || [];\n\t\t\tres.byCategory[categoryId].push(spec);\n\t\t}\n\t}\n\treturn res;\n};\n\nexport const GM = GM_fixer({\n\t'Piano': ['1 Acoustic Grand Piano', '2 Bright Acoustic Piano', '3 Electric Grand Piano', '4 Honky-tonk Piano', '5 Electric Piano 1', '6 Electric Piano 2', '7 Harpsichord', '8 Clavinet'],\n\t'Chromatic Percussion': ['9 Celesta', '10 Glockenspiel', '11 Music Box', '12 Vibraphone', '13 Marimba', '14 Xylophone', '15 Tubular Bells', '16 Dulcimer'],\n\t'Organ': ['17 Drawbar Organ', '18 Percussive Organ', '19 Rock Organ', '20 Church Organ', '21 Reed Organ', '22 Accordion', '23 Harmonica', '24 Tango Accordion'],\n\t'Guitar': ['25 Acoustic Guitar (nylon)', '26 Acoustic Guitar (steel)', '27 Electric Guitar (jazz)', '28 Electric Guitar (clean)', '29 Electric Guitar (muted)', '30 Overdriven Guitar', '31 Distortion Guitar', '32 Guitar Harmonics'],\n\t'Bass': ['33 Acoustic Bass', '34 Electric Bass (finger)', '35 Electric Bass (pick)', '36 Fretless Bass', '37 Slap Bass 1', '38 Slap Bass 2', '39 Synth Bass 1', '40 Synth Bass 2'],\n\t'Strings': ['41 Violin', '42 Viola', '43 Cello', '44 Contrabass', '45 Tremolo Strings', '46 Pizzicato Strings', '47 Orchestral Harp', '48 Timpani'],\n\t'Ensemble': ['49 String Ensemble 1', '50 String Ensemble 2', '51 Synth Strings 1', '52 Synth Strings 2', '53 Choir Aahs', '54 Voice Oohs', '55 Synth Choir', '56 Orchestra Hit'],\n\t'Brass': ['57 Trumpet', '58 Trombone', '59 Tuba', '60 Muted Trumpet', '61 French Horn', '62 Brass Section', '63 Synth Brass 1', '64 Synth Brass 2'],\n\t'Reed': ['65 Soprano Sax', '66 Alto Sax', '67 Tenor Sax', '68 Baritone Sax', '69 Oboe', '70 English Horn', '71 Bassoon', '72 Clarinet'],\n\t'Pipe': ['73 Piccolo', '74 Flute', '75 Recorder', '76 Pan Flute', '77 Blown Bottle', '78 Shakuhachi', '79 Whistle', '80 Ocarina'],\n\t'Synth Lead': ['81 Lead 1 (square)', '82 Lead 2 (sawtooth)', '83 Lead 3 (calliope)', '84 Lead 4 (chiff)', '85 Lead 5 (charang)', '86 Lead 6 (voice)', '87 Lead 7 (fifths)', '88 Lead 8 (bass + lead)'],\n\t'Synth Pad': ['89 Pad 1 (new age)', '90 Pad 2 (warm)', '91 Pad 3 (polysynth)', '92 Pad 4 (choir)', '93 Pad 5 (bowed)', '94 Pad 6 (metallic)', '95 Pad 7 (halo)', '96 Pad 8 (sweep)'],\n\t'Synth Effects': ['97 FX 1 (rain)', '98 FX 2 (soundtrack)', '99 FX 3 (crystal)', '100 FX 4 (atmosphere)', '101 FX 5 (brightness)', '102 FX 6 (goblins)', '103 FX 7 (echoes)', '104 FX 8 (sci-fi)'],\n\t'Ethnic': ['105 Sitar', '106 Banjo', '107 Shamisen', '108 Koto', '109 Kalimba', '110 Bagpipe', '111 Fiddle', '112 Shanai'],\n\t'Percussive': ['113 Tinkle Bell', '114 Agogo', '115 Steel Drums', '116 Woodblock', '117 Taiko Drum', '118 Melodic Tom', '119 Synth Drum'],\n\t'Sound effects': ['120 Reverse Cymbal', '121 Guitar Fret Noise', '122 Breath Noise', '123 Seashore', '124 Bird Tweet', '125 Telephone Ring', '126 Helicopter', '127 Applause', '128 Gunshot']\n});\n\n/* channels\n--------------------------------------------------- */\nconst get_channels = () => { // 0 - 15 channels\n\tconst channels = {};\n\tfor (let i = 0; i < 16; i++) {\n\t\tchannels[i] = { // default values\n\t\t\tprogram: i,\n\t\t\tpitchBend: 0,\n\t\t\tmute: false,\n\t\t\tmono: false,\n\t\t\tomni: false,\n\t\t\tsolo: false\n\t\t};\n\t}\n\treturn channels;\n};\n\nexport const channels = get_channels();\n\n\n\n/* get/setInstrument\n--------------------------------------------------- */\nexport const getProgram = (channelId) => {\n\tconst channel = channels[channelId];\n\treturn channel && channel.program;\n};\n\nexport const setProgram = (channelId, program, delay) => {\n\tconst channel = channels[channelId];\n\tif (delay) {\n\t\treturn setTimeout(() => {\n\t\t\tchannel.program = program;\n\t\t}, delay);\n\t} else {\n\t\tchannel.program = program;\n\t}\n};\n\n/* get/setMono\n--------------------------------------------------- */\nexport const getMono = (channelId) => {\n\tconst channel = channels[channelId];\n\treturn channel && channel.mono;\n};\n\nexport const setMono = (channelId, truthy, delay) => {\n\tconst channel = channels[channelId];\n\tif (delay) {\n\t\treturn setTimeout(() => {\n\t\t\tchannel.mono = truthy;\n\t\t}, delay);\n\t} else {\n\t\tchannel.mono = truthy;\n\t}\n};\n\n/* get/setOmni\n--------------------------------------------------- */\nexport const getOmni = (channelId) => {\n\tconst channel = channels[channelId];\n\treturn channel && channel.omni;\n};\n\nexport const setOmni = (channelId, truthy, delay) => {\n\tconst channel = channels[channelId];\n\tif (delay) {\n\t\treturn setTimeout(() => {\n\t\t\tchannel.omni = truthy;\n\t\t}, delay);\n\t} else {\n\t\tchannel.omni = truthy;\n\t}\n};\n\n/* get/setSolo\n--------------------------------------------------- */\nexport const getSolo = channelId => {\n\tconst channel = channels[channelId];\n\treturn channel && channel.solo;\n};\n\nexport const setSolo = (channelId, truthy) => {\n\tconst channel = channels[channelId];\n\tif (delay) {\n\t\treturn setTimeout(() => {\n\t\t\tchannel.solo = truthy;\n\t\t}, delay);\n\t} else {\n\t\tchannel.solo = truthy;\n\t}\n};\n\n\n/* note conversions\n--------------------------------------------------- */\nexport const keyToNote = {}; // C8  == 108\nexport const noteToKey = {}; // 108 ==  C8\n\n(function() {\n\tconst A0 = 0x15; // first note\n\tconst C8 = 0x6C; // last note\n\tconst number2key = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\n\tfor (let n = A0; n <= C8; n++) {\n\t\tconst octave = (n - 12) / 12 >> 0;\n\t\tconst name = number2key[n % 12] + octave;\n\t\tkeyToNote[name] = n;\n\t\tnoteToKey[n] = name;\n\t}\n})();\n","/*\n\t----------------------------------------------------------------------\n\tAudioTag <audio> - OGG or MPEG Soundbank\n\t----------------------------------------------------------------------\n\thttp://dev.w3.org/html5/spec/Overview.html#the-audio-element\n\t----------------------------------------------------------------------\n*/\nimport { DEBUG } from './debug.js';\nimport { channels, GM, keyToNote, noteToKey } from './gm.js';\n\n// information to share with loader...\nexport const shared_root_info = {};\n\nconst volumes = []; // floating point\nfor (let vid = 0; vid < 16; vid ++) {\n\tvolumes[vid] = 127;\n}\n\n\nlet buffer_nid = -1; // current channel\nconst notesOn = []; // instrumentId + noteId that is currently playing in each 'channel', for routing noteOff/chordOff calls\nconst notes = {}; // the piano keys\n\nconst audioBuffers = []; // the audio channels\nfor (let nid = 0; nid < 12; nid ++) {\n\taudioBuffers[nid] = new Audio();\n}\n\nexport const playChannel = (channel, in_note) => {\n\tif (!channels[channel]) {\n\t\treturn;\n\t}\n\tconst instrument = channels[channel].program;\n\tconst instrumentId = GM.byId[instrument].id;\n\tconst note = notes[in_note];\n\tif (note) {\n\t\tconst instrumentNoteId = instrumentId + '' + note.id;\n\t\tconst nid = (buffer_nid + 1) % audioBuffers.length;\n\t\tconst audio = audioBuffers[nid];\n\t\tnotesOn[nid] = instrumentNoteId;\n\t\tif (!shared_root_info.Soundfont[instrumentId]) {\n\t\t\tif (DEBUG) {\n\t\t\t\tconsole.log('404', instrumentId);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\taudio.src = shared_root_info.Soundfont[instrumentId][note.id];\n\t\taudio.volume = volumes[channel] / 127;\n\t\taudio.play();\n\t\tbuffer_nid = nid;\n\t}\n};\n\nexport const stopChannel = (channel, in_note) => {\n\tif (!channels[channel]) {\n\t\treturn;\n\t}\n\tconst instrument = channels[channel].program;\n\tconst instrumentId = GM.byId[instrument].id;\n\tconst note = notes[in_note];\n\tif (note) {\n\t\tconst instrumentNoteId = instrumentId + '' + note.id;\n\t\tfor (let i = 0, len = audioBuffers.length; i < len; i++) {\n\t\t\tconst nid = (i + buffer_nid + 1) % len;\n\t\t\tconst cId = notesOn[nid];\n\t\t\tif (cId && cId === instrumentNoteId) {\n\t\t\t\taudioBuffers[nid].pause();\n\t\t\t\tnotesOn[nid] = null;\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n};\n\n// midi.audioBuffers = audioBuffers;\nexport const send = (data, delay) => { };\nexport const setController = (channel, type, value, delay) => { };\nexport const setVolume = (channel, n) => {\n\tvolumes[channel] = n;\n};\n\nexport const programChange = (channel, program) => {\n\tchannels[channel].instrument = program;\n};\n\nexport const pitchBend = (channel, program, delay) => { };\n\nexport const noteOn = (channel, note, velocity, delay) => {\n\tconst id = noteToKey[note];\n\tif (!notes[id]) {\n\t\treturn;\n\t}\n\tif (delay) {\n\t\treturn setTimeout(() => {\n\t\t\tvolumes[channel] = velocity;\n\t\t\tplayChannel(channel, id);\n\t\t}, delay * 1000);\n\t} else {\n\t\tvolumes[channel] = velocity;\n\t\tplayChannel(channel, id);\n\t}\n};\n\nexport const noteOff = (channel, note, delay) => {\n\t// MSC: Commented out in MudCube version...\n\t//      I see why!  clips all the notes!\n\n\t// const id = noteToKey[note];\n\t// if (!notes[id]) {\n\t// \treturn;\n\t// }\n\t// if (delay) {\n\t// \treturn setTimeout(function() {\n\t// \t\tstopChannel(channel, id);\n\t// \t}, delay * 1000)\n\t// } else {\n\t// \tstopChannel(channel, id);\n\t// }\n};\n\nexport const chordOn = (channel, chord, velocity, delay) => {\n\tfor (let idx = 0; idx < chord.length; idx ++) {\n\t\tconst n = chord[idx];\n\t\tconst id = noteToKey[n];\n\t\tif (!notes[id]) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (delay) {\n\t\t\treturn setTimeout(() => {\n\t\t\t\tplayChannel(channel, id);\n\t\t\t}, delay * 1000);\n\t\t} else {\n\t\t\tplayChannel(channel, id);\n\t\t}\n\t}\n};\n\nexport const chordOff = (channel, chord, delay) => {\n\tfor (let idx = 0; idx < chord.length; idx ++) {\n\t\tconst n = chord[idx];\n\t\tconst id = noteToKey[n];\n\t\tif (!notes[id]) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (delay) {\n\t\t\treturn setTimeout(() => {\n\t\t\t\tstopChannel(channel, id);\n\t\t\t}, delay * 1000);\n\t\t} else {\n\t\t\tstopChannel(channel, id);\n\t\t}\n\t}\n};\n\nexport const stopAllNotes = () => {\n\tfor (let nid = 0, length = audioBuffers.length; nid < length; nid++) {\n\t\taudioBuffers[nid].pause();\n\t}\n};\n\nexport const connect = opts => {\n\tfor (const key in keyToNote) {\n\t\tnotes[key] = {id: key};\n\t}\n\t//\n\topts.onsuccess && opts.onsuccess();\n};\n","/**\n * @license -------------------------------------------------------------------\n *   module: Base64Binary\n *      src: http://blog.danguer.com/2011/10/24/base64-binary-decoding-in-javascript/\n *  license: Simplified BSD License\n * -------------------------------------------------------------------\n * Copyright 2011, Daniel Guerrero. All rights reserved.\n * \n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     - Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     - Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n * \n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL DANIEL GUERRERO BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n/**\n * Modified by MSC to be a module.\n * @type {string}\n * @private\n */\n\nconst _keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n\n/* will return a  Uint8Array type */\nexport function decodeArrayBuffer(input) {\n\tconst bytes = Math.ceil((3 * input.length) / 4.0);\n\tconst ab = new ArrayBuffer(bytes);\n\tdecode(input, ab);\n\n\treturn ab;\n}\n\nexport function decode(input, arrayBuffer) {\n\t//get last chars to see if are valid\n\tlet lkey1 = _keyStr.indexOf(input.charAt(input.length - 1));\n\tlet lkey2 = _keyStr.indexOf(input.charAt(input.length - 1));\n\n\tlet bytes = Math.ceil((3 * input.length) / 4.0);\n\tif (lkey1 === 64) {\n\t\tbytes--;\n\t} //padding chars, so skip\n\tif (lkey2 === 64) {\n\t\tbytes--;\n\t} //padding chars, so skip\n\n\tlet uarray;\n\tlet chr1, chr2, chr3;\n\tlet enc1, enc2, enc3, enc4;\n\tlet j = 0;\n\n\tif (arrayBuffer) {\n\t\tuarray = new Uint8Array(arrayBuffer);\n\t} else {\n\t\tuarray = new Uint8Array(bytes);\n\t}\n\n\tinput = input.replace(/[^A-Za-z0-9+\\/=]/g, \"\");\n\n\tfor (let i = 0; i < bytes; i += 3) {\n\t\t// get the 3 octets in 4 ascii chars\n\t\tenc1 = _keyStr.indexOf(input.charAt(j++));\n\t\tenc2 = _keyStr.indexOf(input.charAt(j++));\n\t\tenc3 = _keyStr.indexOf(input.charAt(j++));\n\t\tenc4 = _keyStr.indexOf(input.charAt(j++));\n\n\t\tchr1 = (enc1 << 2) | (enc2 >> 4);\n\t\tchr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n\t\tchr3 = ((enc3 & 3) << 6) | enc4;\n\n\t\tuarray[i] = chr1;\n\t\tif (enc3 !== 64) {\n\t\t\tuarray[i+1] = chr2;\n\t\t}\n\t\tif (enc4 !== 64) {\n\t\t\tuarray[i+2] = chr3;\n\t\t}\n\t}\n\n\treturn uarray;\n}\n","/*\n\t----------------------------------------------------------\n\tWeb Audio API - OGG or MPEG Soundbank\n\t----------------------------------------------------------\n\thttp://webaudio.github.io/web-audio-api/\n\t----------------------------------------------------------\n*/\nimport { DEBUG } from './debug.js';\nimport { channels, GM, keyToNote, noteToKey } from './gm.js';\nimport * as Base64Binary from './shim/Base64binary.js';\n// information to share with loader...\nexport const shared_root_info = {};\n\nconst audioContext = null; // new AudioContext();\nlet useStreamingBuffer = false; // !!audioContext.createMediaElementSource;\nlet ctx; // audio context\nconst sources = {};\nconst effects = {};\nlet masterVolume = 127;\nconst audioBuffers = {};\n\nexport const send = (data, delay) => { };\nexport const setController = (channelId, type, value, delay) => { };\n\nexport const setVolume = (channelId, volume, delay) => {\n    if (delay) {\n        setTimeout(() => {\n            masterVolume = volume;\n        }, delay * 1000);\n    } else {\n        masterVolume = volume;\n    }\n};\n\nexport const programChange = (channelId, program, delay) => {\n    // delay is ignored\n    const channel = channels[channelId];\n    if (channel) {\n        channel.program = program;\n    }\n};\n\nexport const pitchBend = function(channelId, bend, delay) {\n    // delay is ignored\n    const channel = channels[channelId];\n    if (channel) {\n        if (delay) {\n            setTimeout(() => channel.pitchBend = bend,\n                delay);\n        } else {\n            channel.pitchBend = bend;\n        }\n    }\n};\n\nexport const noteOn = (channelId, noteId, velocity, delay) => {\n    delay = delay || 0;\n\n    // check whether the note exists\n    const channel = channels[channelId];\n    const program = channel.program;\n    const bufferId = program + 'x' + noteId;\n    const buffer = audioBuffers[bufferId];\n    if (!buffer) {\n        if (DEBUG) {\n            console.log('no buffer', GM.byId[program].id, program, channelId);\n        }\n        return;\n    }\n\n    // convert relative delay to absolute delay\n    if (delay < ctx.currentTime) {\n        delay += ctx.currentTime;\n    }\n\n    // create audio buffer\n    let source;\n    if (useStreamingBuffer) {\n        source = ctx.createMediaElementSource(buffer);\n    } else { // XMLHTTP buffer\n        source = ctx.createBufferSource();\n        source.buffer = buffer;\n    }\n\n    // add effects to buffer\n    if (effects) {\n        let chain = source;\n        for (let key in effects) {\n            chain.connect(effects[key].input);\n            chain = effects[key];\n        }\n    }\n\n    // add gain + pitchShift\n    const gain = (velocity / 127) * (masterVolume / 127) * 2 - 1;\n    source.connect(ctx.destination);\n    source.playbackRate.value = 1; // pitch shift\n    source.gainNode = ctx.createGain(); // gain\n    source.gainNode.connect(ctx.destination);\n    source.gainNode.gain.value = Math.min(1.0, Math.max(-1.0, gain));\n    source.connect(source.gainNode);\n\n    if (useStreamingBuffer) {\n        if (delay) {\n            return setTimeout(() => {\n                buffer.currentTime = 0;\n                buffer.play()\n            }, delay * 1000);\n        } else {\n            buffer.currentTime = 0;\n            buffer.play()\n        }\n    } else {\n        source.start(delay || 0);\n    }\n\n    sources[channelId + 'x' + noteId] = source;\n\n    return source;\n};\n\nexport const noteOff = (channelId, noteId, delay) => {\n    delay = delay || 0;\n\n    // check whether the note exists\n    const channel = channels[channelId];\n    const program = channel.program;\n    const bufferId = program + 'x' + noteId;\n    const buffer = audioBuffers[bufferId];\n    if (buffer) {\n        if (delay < ctx.currentTime) {\n            delay += ctx.currentTime;\n        }\n\n        let source = sources[channelId + 'x' + noteId];\n        if (source) {\n            if (source.gainNode) {\n                // @Miranet: 'the values of 0.2 and 0.3 could of course be used as\n                // a 'release' parameter for ADSR like time settings.'\n                // add { 'metadata': { release: 0.3 } } to soundfont files\n                const gain = source.gainNode.gain;\n                gain.linearRampToValueAtTime(gain.value, delay);\n                gain.linearRampToValueAtTime(-1.0, delay + 0.3);\n            }\n            if (useStreamingBuffer) {\n                if (delay) {\n                    setTimeout(() => {\n                        buffer.pause();\n                    }, delay * 1000);\n                } else {\n                    buffer.pause();\n                }\n            } else {\n                if (source.noteOff) {\n                    source.noteOff(delay + 0.5);\n                } else {\n                    source.stop(delay + 0.5);\n                }\n            }\n\n            delete sources[channelId + 'x' + noteId];\n            return source;\n        }\n    }\n};\n\nexport const chordOn = (channel, chord, velocity, delay) => {\n    const res = {};\n    for (const note of chord) {\n        res[note] = noteOn(channel, note, velocity, delay);\n    }\n    return res;\n};\n\nexport const chordOff = (channel, chord, delay) => {\n    const res = {};\n    for (const note of chord) {\n        res[note] = noteOff(channel, note, delay);\n    }\n    return res;\n};\n\n\n\nexport const stopAllNotes = () => {\n    for (let sid in sources) {\n        let delay = 0;\n        if (delay < ctx.currentTime) {\n            delay += ctx.currentTime;\n        }\n        const source = sources[sid];\n        source.gain.linearRampToValueAtTime(1, delay);\n        source.gain.linearRampToValueAtTime(0, delay + 0.3);\n        if (source.noteOff) { // old api\n            source.noteOff(delay + 0.3);\n        } else { // new api\n            source.stop(delay + 0.3);\n        }\n        delete sources[sid];\n    }\n};\n\nexport const setEffects = list => {\n    if (ctx && ctx.tunajs) {\n        for (const data of list) {\n            const effect = new ctx.tunajs[data.type](data);\n            effect.connect(ctx.destination);\n            effects[data.type] = effect;\n        }\n    } else {\n        return console.log('Effects module not installed.');\n    }\n};\n\nexport const connect = opts => {\n    setContext(ctx || createAudioContext(), opts.onsuccess);\n};\n\nexport const getContext = () => {\n    return ctx;\n};\n\nexport const setContext = (newCtx, onsuccess, onprogress, onerror) => {\n    ctx = newCtx;\n\n    // tuna.js effects module - https://github.com/Dinahmoe/tuna\n    if (typeof Tuna !== 'undefined' && !(ctx.tunajs instanceof Tuna)) {\n        ctx.tunajs = new Tuna(ctx);\n    }\n\n    // loading audio files\n    const urls = [];\n    for (let key in keyToNote) {\n        urls.push(key);\n    }\n\n    const waitForEnd = instrument => {\n        for (const key of Object.keys(bufferPending)) { // has pending items\n            if (bufferPending[key]) {\n                return;\n            }\n        }\n\n        if (onsuccess) { // run onsuccess once\n            onsuccess();\n            onsuccess = null;\n        }\n    };\n\n    const requestAudio = (soundfont, programId, index, key) => {\n        const url = soundfont[key];\n        if (url) {\n            bufferPending[programId] ++;\n            loadAudio(url, buffer => {\n                buffer.id = key;\n                const noteId = keyToNote[key];\n                audioBuffers[programId + 'x' + noteId] = buffer;\n\n                if (--bufferPending[programId] === 0) {\n                    const percent = index / 87;\n                    if (DEBUG) {\n                        console.log(GM.byId[programId], 'processing: ', percent);\n                    }\n                    soundfont.isLoaded = true;\n                    waitForEnd(programId);\n                }\n            }, err => {\n                console.log(err);\n            });\n        }\n    };\n\n    const bufferPending = {};\n    for (const [instrument, soundfont] of Object.entries(shared_root_info.Soundfont)) {\n        if (soundfont.isLoaded) {\n            continue;\n        }\n\n        const spec = GM.byName[instrument];\n        if (spec) {\n            const programId = spec.program;\n\n            bufferPending[programId] = 0;\n\n            for (let index = 0; index < urls.length; index++) {\n                const key = urls[index];\n                requestAudio(soundfont, programId, index, key);\n            }\n        }\n    }\n    setTimeout(waitForEnd, 1);\n};\n\n/* Load audio file: streaming | base64 | arraybuffer\n---------------------------------------------------------------------- */\nexport const loadAudio = (url, onsuccess, onerror) => {\n    if (useStreamingBuffer) {\n        const audio = new Audio();\n        audio.src = url;\n        audio.controls = false;\n        audio.autoplay = false;\n        audio.preload = false;\n        audio.addEventListener('canplay', () => {\n            onsuccess && onsuccess(audio);\n        });\n        audio.addEventListener('error', err => {\n            onerror && onerror(err);\n        });\n        document.body.appendChild(audio);\n    } else if (url.indexOf('data:audio') === 0) { // Base64 string\n        const base64 = url.split(',')[1];\n        const buffer = Base64Binary.decodeArrayBuffer(base64);\n        return ctx.decodeAudioData(buffer, onsuccess, onerror);\n    } else {  // XMLHTTP buffer\n        const request = new XMLHttpRequest();\n        request.open('GET', url, true);\n        request.responseType = 'arraybuffer';\n        request.onsuccess = () => {\n            return ctx.decodeAudioData(request.response, onsuccess, onerror);\n        };\n        request.send();\n    }\n};\n\nexport const createAudioContext = () => {\n    return new (window.AudioContext || window.webkitAudioContext)();\n};\n","/*\n\t----------------------------------------------------------------------\n\tWeb MIDI API - Native Soundbanks\n\t----------------------------------------------------------------------\n\thttp://webaudio.github.io/web-midi-api/\n\t----------------------------------------------------------------------\n*/\n\n// information to share with loader...\nexport const shared_root_info = {};\n\n\nlet plugin = null;\nlet output = null;\nconst channels = [];\n\nexport const send = (data, delay) => { // set channel volume\n\toutput.send(data, delay * 1000);\n};\n\nexport const setController = (channel, type, value, delay) => {\n\toutput.send([channel, type, value], delay * 1000);\n};\n\nexport const setVolume = (channel, volume, delay) => { // set channel volume\n\toutput.send([0xB0 + channel, 0x07, volume], delay * 1000);\n};\n\nexport const programChange = (channel, program, delay) => { // change patch (instrument)\n\toutput.send([0xC0 + channel, program], delay * 1000);\n};\n\nexport const pitchBend = (channel, program, delay) => { // pitch bend\n\toutput.send([0xE0 + channel, program], delay * 1000);\n};\n\nexport const noteOn = (channel, note, velocity, delay) => {\n\toutput.send([0x90 + channel, note, velocity], delay * 1000);\n};\n\nexport const noteOff = (channel, note, delay) => {\n\toutput.send([0x80 + channel, note, 0], delay * 1000);\n};\n\nexport const chordOn = (channel, chord, velocity, delay) => {\n\tfor (const note of chord) {\n\t\toutput.send([0x90 + channel, note, velocity], delay * 1000);\n\t}\n};\n\nexport const chordOff = (channel, chord, delay) => {\n\tfor (const note of chord) {\n\t\toutput.send([0x80 + channel, note, 0], delay * 1000);\n\t}\n};\n\nexport const stopAllNotes = () => {\n\toutput.cancel();\n\tfor (let channel = 0; channel < 16; channel ++) {\n\t\toutput.send([0xB0 + channel, 0x7B, 0]);\n\t}\n};\n\nexport const connect = opts => {\n\tconst errFunction = err => {\n\t\tconsole.error('Could not connect to web midi! Falling back to WebAudio:', err);\n\t\t// we tried.  Anything that sort of supports webmidi should support WebAudio.\n\t\tif (shared_root_info.webaudio_backup_connect) {\n\t\t\tshared_root_info.config.api = 'webaudio';\n\t\t\tshared_root_info.webaudio_backup_connect(opts);\n\t\t}\n\t};\n\tnavigator.requestMIDIAccess().then(access => {\n\t\tconst plugin = access;\n\t\tconst pluginOutputs = plugin.outputs;\n\t\tif (typeof pluginOutputs == 'function') { // Chrome pre-43\n\t\t\toutput = pluginOutputs()[0];\n\t\t} else { // Chrome post-43\n\t\t\toutput = pluginOutputs[0];\n\t\t}\n\t\tif (output === undefined) { // nothing there...\n\t\t\terrFunction('No outputs defined');\n\t\t} else {\n\t\t\topts.onsuccess && opts.onsuccess();\n\t\t}\n\t}, errFunction);\n};\n","/* Wrapper for accessing strings through sequential reads */\n/* now an ES6 class -- MSC 2019 */\n\nexport class Stream {\n\tconstructor(str) {\n\t\tthis.str = str;\n\t\tthis.position = 0;\n\t}\n\n\tread(length) {\n\t\tconst result = this.str.substr(this.position, length);\n\t\tthis.position += length;\n\t\treturn result;\n\t}\n\t\n\t/* read a big-endian 32-bit integer */\n\treadInt32() {\n\t\tconst result = (\n\t\t\t(this.str.charCodeAt(this.position) << 24)\n\t\t\t+ (this.str.charCodeAt(this.position + 1) << 16)\n\t\t\t+ (this.str.charCodeAt(this.position + 2) << 8)\n\t\t\t+ this.str.charCodeAt(this.position + 3));\n\t\tthis.position += 4;\n\t\treturn result;\n\t}\n\n\t/* read a big-endian 16-bit integer */\n\treadInt16() {\n\t\tconst result = (\n\t\t\t(this.str.charCodeAt(this.position) << 8)\n\t\t\t+ this.str.charCodeAt(this.position + 1));\n\t\tthis.position += 2;\n\t\treturn result;\n\t}\n\t\n\t/* read an 8-bit integer */\n\treadInt8(signed) {\n\t\tlet result = this.str.charCodeAt(this.position);\n\t\tif (signed && result > 127) {\n\t\t\tresult -= 256;\n\t\t}\n\t\tthis.position += 1;\n\t\treturn result;\n\t}\n\t\n\teof() {\n\t\treturn this.position >= this.str.length;\n\t}\n\t\n\t/* read a MIDI-style variable-length integer\n\t\t(big-endian value in groups of 7 bits,\n\t\twith top bit set to signify that another byte follows)\n\t*/\n\treadVarInt() {\n\t\tlet result = 0;\n\t\twhile (true) {\n\t\t\tlet b = this.readInt8();\n\t\t\t// noinspection JSBitwiseOperatorUsage\n\t\t\tif (b & 0x80) {\n\t\t\t\tresult += (b & 0x7f);\n\t\t\t\tresult <<= 7;\n\t\t\t} else {\n\t\t\t\t/* b is the last byte */\n\t\t\t\treturn result + b;\n\t\t\t}\n\t\t}\n\t}\n}\n","/*\nclass to parse the .mid file format\n(depends on stream.js)\n*/\nimport { Stream } from './stream.js';\n\nexport class MidiFileClass {\n\tconstructor(data) {\n\t\tthis.data = data;\n\t\tthis.stream = new Stream(data);\n\t\tthis.lastEventTypeByte = undefined;\n\t}\n\treadChunk(stream) {\n\t\tconst id = stream.read(4);\n\t\tconst length = stream.readInt32();\n\t\treturn {\n\t\t\t'id': id,\n\t\t\t'length': length,\n\t\t\t'data': stream.read(length)\n\t\t};\n\t}\n\t\n\treadEvent(stream) {\n\t\tconst event = {};\n\t\tevent.deltaTime = stream.readVarInt();\n\t\tlet eventTypeByte = stream.readInt8();\n\t\tif ((eventTypeByte & 0xf0) === 0xf0) {\n\t\t\t/* system / meta event */\n\t\t\tif (eventTypeByte === 0xff) {\n\t\t\t\t/* meta event */\n\t\t\t\tevent.type = 'meta';\n\t\t\t\tconst subtypeByte = stream.readInt8();\n\t\t\t\tconst length = stream.readVarInt();\n\t\t\t\tswitch(subtypeByte) {\n\t\t\t\t\tcase 0x00:\n\t\t\t\t\t\tevent.subtype = 'sequenceNumber';\n\t\t\t\t\t\tif (length !== 2) {\n\t\t\t\t\t\t\tthrow \"Expected length for sequenceNumber event is 2, got \" + length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.number = stream.readInt16();\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x01:\n\t\t\t\t\t\tevent.subtype = 'text';\n\t\t\t\t\t\tevent.text = stream.read(length);\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x02:\n\t\t\t\t\t\tevent.subtype = 'copyrightNotice';\n\t\t\t\t\t\tevent.text = stream.read(length);\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x03:\n\t\t\t\t\t\tevent.subtype = 'trackName';\n\t\t\t\t\t\tevent.text = stream.read(length);\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x04:\n\t\t\t\t\t\tevent.subtype = 'instrumentName';\n\t\t\t\t\t\tevent.text = stream.read(length);\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x05:\n\t\t\t\t\t\tevent.subtype = 'lyrics';\n\t\t\t\t\t\tevent.text = stream.read(length);\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x06:\n\t\t\t\t\t\tevent.subtype = 'marker';\n\t\t\t\t\t\tevent.text = stream.read(length);\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x07:\n\t\t\t\t\t\tevent.subtype = 'cuePoint';\n\t\t\t\t\t\tevent.text = stream.read(length);\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x20:\n\t\t\t\t\t\tevent.subtype = 'midiChannelPrefix';\n\t\t\t\t\t\tif (length !== 1) {\n\t\t\t\t\t\t\tthrow \"Expected length for midiChannelPrefix event is 1, got \" + length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.channel = stream.readInt8();\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x2f:\n\t\t\t\t\t\tevent.subtype = 'endOfTrack';\n\t\t\t\t\t\tif (length !== 0) {\n\t\t\t\t\t\t\tthrow \"Expected length for endOfTrack event is 0, got \" + length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x51:\n\t\t\t\t\t\tevent.subtype = 'setTempo';\n\t\t\t\t\t\tif (length !== 3) throw \"Expected length for setTempo event is 3, got \" + length;\n\t\t\t\t\t\tevent.microsecondsPerBeat = (\n\t\t\t\t\t\t\t(stream.readInt8() << 16)\n\t\t\t\t\t\t\t+ (stream.readInt8() << 8)\n\t\t\t\t\t\t\t+ stream.readInt8()\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x54:\n\t\t\t\t\t\tevent.subtype = 'smpteOffset';\n\t\t\t\t\t\tif (length !== 5) {\n\t\t\t\t\t\t\tthrow \"Expected length for smpteOffset event is 5, got \" + length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst hourByte = stream.readInt8();\n\t\t\t\t\t\tevent.frameRate = {\n\t\t\t\t\t\t\t0x00: 24,\n\t\t\t\t\t\t\t0x20: 25,\n\t\t\t\t\t\t\t0x40: 29,\n\t\t\t\t\t\t\t0x60: 30\n\t\t\t\t\t\t}[hourByte & 0x60];\n\t\t\t\t\t\tevent.hour = hourByte & 0x1f;\n\t\t\t\t\t\tevent.min = stream.readInt8();\n\t\t\t\t\t\tevent.sec = stream.readInt8();\n\t\t\t\t\t\tevent.frame = stream.readInt8();\n\t\t\t\t\t\tevent.subframe = stream.readInt8();\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x58:\n\t\t\t\t\t\tevent.subtype = 'timeSignature';\n\t\t\t\t\t\tif (length !== 4) {\n\t\t\t\t\t\t\tthrow \"Expected length for timeSignature event is 4, got \" + length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.numerator = stream.readInt8();\n\t\t\t\t\t\tevent.denominator = Math.pow(2, stream.readInt8());\n\t\t\t\t\t\tevent.metronome = stream.readInt8();\n\t\t\t\t\t\tevent.thirtyseconds = stream.readInt8();\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x59:\n\t\t\t\t\t\tevent.subtype = 'keySignature';\n\t\t\t\t\t\tif (length !== 2) {\n\t\t\t\t\t\t\tthrow \"Expected length for keySignature event is 2, got \" + length;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.key = stream.readInt8(true);\n\t\t\t\t\t\tevent.scale = stream.readInt8();\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tcase 0x7f:\n\t\t\t\t\t\tevent.subtype = 'sequencerSpecific';\n\t\t\t\t\t\tevent.data = stream.read(length);\n\t\t\t\t\t\treturn event;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\t// console.log(\"Unrecognised meta event subtype: \" + subtypeByte);\n\t\t\t\t\t\tevent.subtype = 'unknown';\n\t\t\t\t\t\tevent.data = stream.read(length);\n\t\t\t\t\t\treturn event;\n\t\t\t\t}\n\t\t\t} else if (eventTypeByte === 0xf0) {\n\t\t\t\tevent.type = 'sysEx';\n\t\t\t\tconst length = stream.readVarInt();\n\t\t\t\tevent.data = stream.read(length);\n\t\t\t\treturn event;\n\t\t\t} else if (eventTypeByte === 0xf7) {\n\t\t\t\tevent.type = 'dividedSysEx';\n\t\t\t\tconst length = stream.readVarInt();\n\t\t\t\tevent.data = stream.read(length);\n\t\t\t\treturn event;\n\t\t\t} else {\n\t\t\t\tthrow \"Unrecognised MIDI event type byte: \" + eventTypeByte;\n\t\t\t}\n\t\t} else {\n\t\t\t/* channel event */\n\t\t\tlet param1;\n\t\t\tif ((eventTypeByte & 0x80) === 0) {\n\t\t\t\t/* running status - reuse lastEventTypeByte as the event type.\n\t\t\t\t\teventTypeByte is actually the first parameter\n\t\t\t\t*/\n\t\t\t\tparam1 = eventTypeByte;\n\t\t\t\teventTypeByte = this.lastEventTypeByte;\n\t\t\t} else {\n\t\t\t\tparam1 = stream.readInt8();\n\t\t\t\tthis.lastEventTypeByte = eventTypeByte;\n\t\t\t}\n\t\t\tconst eventType = eventTypeByte >> 4;\n\t\t\tevent.channel = eventTypeByte & 0x0f;\n\t\t\tevent.type = 'channel';\n\t\t\tswitch (eventType) {\n\t\t\t\tcase 0x08:\n\t\t\t\t\tevent.subtype = 'noteOff';\n\t\t\t\t\tevent.noteNumber = param1;\n\t\t\t\t\tevent.velocity = stream.readInt8();\n\t\t\t\t\treturn event;\n\t\t\t\tcase 0x09:\n\t\t\t\t\tevent.noteNumber = param1;\n\t\t\t\t\tevent.velocity = stream.readInt8();\n\t\t\t\t\tif (event.velocity === 0) {\n\t\t\t\t\t\tevent.subtype = 'noteOff';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tevent.subtype = 'noteOn';\n\t\t\t\t\t}\n\t\t\t\t\treturn event;\n\t\t\t\tcase 0x0a:\n\t\t\t\t\tevent.subtype = 'noteAftertouch';\n\t\t\t\t\tevent.noteNumber = param1;\n\t\t\t\t\tevent.amount = stream.readInt8();\n\t\t\t\t\treturn event;\n\t\t\t\tcase 0x0b:\n\t\t\t\t\tevent.subtype = 'controller';\n\t\t\t\t\tevent.controllerType = param1;\n\t\t\t\t\tevent.value = stream.readInt8();\n\t\t\t\t\treturn event;\n\t\t\t\tcase 0x0c:\n\t\t\t\t\tevent.subtype = 'programChange';\n\t\t\t\t\tevent.programNumber = param1;\n\t\t\t\t\treturn event;\n\t\t\t\tcase 0x0d:\n\t\t\t\t\tevent.subtype = 'channelAftertouch';\n\t\t\t\t\tevent.amount = param1;\n\t\t\t\t\treturn event;\n\t\t\t\tcase 0x0e:\n\t\t\t\t\tevent.subtype = 'pitchBend';\n\t\t\t\t\tevent.value = param1 + (stream.readInt8() << 7);\n\t\t\t\t\treturn event;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow \"Unrecognised MIDI event type: \" + eventType\n\t\t\t\t\t/* \n\t\t\t\t\tconsole.log(\"Unrecognised MIDI event type: \" + eventType);\n\t\t\t\t\tstream.readInt8();\n\t\t\t\t\tevent.subtype = 'unknown';\n\t\t\t\t\treturn event;\n\t\t\t\t\t*/\n\t\t\t}\n\t\t}\n\t}\n\n\tparseAndReturn() {\n\t\tconst stream = this.stream;\n\t\tconst headerChunk = this.readChunk(stream);\n\t\tif (headerChunk.id !== 'MThd' || headerChunk.length !== 6) {\n\t\t\tthrow \"Bad .mid file - header not found\";\n\t\t}\n\t\tconst headerStream = new Stream(headerChunk.data);\n\t\tconst formatType = headerStream.readInt16();\n\t\tconst trackCount = headerStream.readInt16();\n\t\tconst timeDivision = headerStream.readInt16();\n\n\t\tlet ticksPerBeat;\n\t\tif (timeDivision & 0x8000) {\n\t\t\tthrow \"Expressing time division in SMTPE frames is not supported yet\"\n\t\t} else {\n\t\t\tticksPerBeat = timeDivision;\n\t\t}\n\n\t\tconst header = {\n\t\t\t'formatType': formatType,\n\t\t\t'trackCount': trackCount,\n\t\t\t'ticksPerBeat': ticksPerBeat,\n\t\t};\n\t\tconst tracks = [];\n\t\tfor (let i = 0; i < header.trackCount; i++) {\n\t\t\ttracks[i] = [];\n\t\t\tconst trackChunk = this.readChunk(stream);\n\t\t\tif (trackChunk.id !== 'MTrk') {\n\t\t\t\tthrow \"Unexpected chunk - expected MTrk, got \"+ trackChunk.id;\n\t\t\t}\n\t\t\tconst trackStream = new Stream(trackChunk.data);\n\t\t\twhile (!trackStream.eof()) {\n\t\t\t\tconst event = this.readEvent(trackStream);\n\t\t\t\ttracks[i].push(event);\n\t\t\t\t//console.log(event);\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\t'header': header,\n\t\t\t'tracks': tracks,\n\t\t};\n\t}\n}\n\nexport function MidiFile(data) {\n\tconst midiFileObject = new MidiFileClass(data);\n\treturn midiFileObject.parseAndReturn();\n}\n","/**\n * Replayer class -- factored from function by MSC July 2019\n *\n */\n\n\n/**\n * Clone any object\n *\n * @param {*} o\n * @returns {Array|*}\n */\nconst clone = o => {\n\tif (typeof o != 'object') {\n\t\treturn o;\n\t}\n\tif (o == null) {\n\t\treturn o;\n\t}\n\tconst ret = (typeof o.length == 'number') ? [] : {};\n\tfor (let key in o) {\n\t\t// noinspection JSUnfilteredForInLoop\n\t\tret[key] = clone(o[key]);\n\t}\n\treturn ret;\n};\n\nexport class Replayer {\n\tconstructor(midiFile, timeWarp, eventProcessor, bpm) {\n\t\tthis.midiFile = midiFile;\n\t\tthis.timeWarp = timeWarp;\n\t\tthis.eventProcessor = eventProcessor;\n\t\tthis.trackStates = [];\n\t\tthis.beatsPerMinute = bpm ? bpm : 120;\n\t\tthis.bpmOverride = !!bpm;\n\t\tthis.ticksPerBeat = midiFile.header.ticksPerBeat;\n\n\t\tfor (let i = 0; i < midiFile.tracks.length; i++) {\n\t\t\tthis.trackStates[i] = {\n\t\t\t\t'nextEventIndex': 0,\n\t\t\t\t'ticksToNextEvent': (\n\t\t\t\t\tmidiFile.tracks[i].length ?\n\t\t\t\t\t\tmidiFile.tracks[i][0].deltaTime :\n\t\t\t\t\t\tnull\n\t\t\t\t)\n\t\t\t};\n\t\t}\n\t\tthis.temporal = [];\n\t\tthis.processEvents();\n\t}\n\n\tgetNextEvent() {\n\t\tlet ticksToNextEvent = null;\n\t\tlet nextEventTrack = null;\n\t\tlet nextEventIndex = null;\n\t\t\n\t\tfor (let i = 0; i < this.trackStates.length; i++) {\n\t\t\tif (\n\t\t\t\tthis.trackStates[i].ticksToNextEvent != null\n\t\t\t\t&& (ticksToNextEvent == null || this.trackStates[i].ticksToNextEvent < ticksToNextEvent)\n\t\t\t) {\n\t\t\t\tticksToNextEvent = this.trackStates[i].ticksToNextEvent;\n\t\t\t\tnextEventTrack = i;\n\t\t\t\tnextEventIndex = this.trackStates[i].nextEventIndex;\n\t\t\t}\n\t\t}\n\t\tif (nextEventTrack != null) {\n\t\t\t/* consume event from that track */\n\t\t\tconst nextEvent = this.midiFile.tracks[nextEventTrack][nextEventIndex];\n\t\t\tif (this.midiFile.tracks[nextEventTrack][nextEventIndex + 1]) {\n\t\t\t\tthis.trackStates[nextEventTrack].ticksToNextEvent += this.midiFile.tracks[nextEventTrack][nextEventIndex + 1].deltaTime;\n\t\t\t} else {\n\t\t\t\tthis.trackStates[nextEventTrack].ticksToNextEvent = null;\n\t\t\t}\n\t\t\tthis.trackStates[nextEventTrack].nextEventIndex += 1;\n\t\t\t/* advance timings on all tracks by ticksToNextEvent */\n\t\t\tfor (let i = 0; i < this.trackStates.length; i++) {\n\t\t\t\tif (this.trackStates[i].ticksToNextEvent != null) {\n\t\t\t\t\tthis.trackStates[i].ticksToNextEvent -= ticksToNextEvent\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {\n\t\t\t\t\"ticksToEvent\": ticksToNextEvent,\n\t\t\t\t\"event\": nextEvent,\n\t\t\t\t\"track\": nextEventTrack\n\t\t\t}\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\n\tprocessEvents() {\n\t\tlet midiEvent = this.getNextEvent();\n\t\twhile(midiEvent) {\n\t\t    if (!this.bpmOverride && midiEvent.event.type === \"meta\" && midiEvent.event.subtype === \"setTempo\" ) {\n\t\t\t\t// tempo change events can occur anywhere in the middle and affect events that follow\n\t\t\t\tthis.beatsPerMinute = 60000000 / midiEvent.event.microsecondsPerBeat;\n\t\t\t}\n\t\t\t//\n\t\t\tlet beatsToGenerate = 0;\n\t\t\tlet secondsToGenerate = 0;\n\t\t\tif (midiEvent.ticksToEvent > 0) {\n\t\t\t\tbeatsToGenerate = midiEvent.ticksToEvent / this.ticksPerBeat;\n\t\t\t\tsecondsToGenerate = beatsToGenerate / (this.beatsPerMinute / 60);\n\t\t\t}\n\n\t\t\tconst time = (secondsToGenerate * 1000 * this.timeWarp) || 0;\n\t\t\tthis.temporal.push([midiEvent, time]);\n\t\t\tmidiEvent = this.getNextEvent();\n\t\t}\n\t}\n\n\tgetData() {\n\t\treturn clone(this.temporal);\n\t}\n}\n","/*\n\t----------------------------------------------------------\n\tMIDI.Player : 0.3.1 : 2015-03-26\n\t----------------------------------------------------------\n\thttps://github.com/mudcube/MIDI.js\n\t----------------------------------------------------------\n*/\nimport { channels, GM } from './gm.js';\nimport { MidiFile } from '../inc/jasmid/midifile.js';\nimport { Replayer } from '../inc/jasmid/replayer.js';\n\nexport class PlayInstance {\n    constructor(plugin) {\n        this.plugin = plugin;\n        this.currentTime = 0;\n        this.endTime = 0;\n        this.restart = 0;\n        this.playing = false;\n        this.timeWarp = 1;\n        this.startDelay = 0;\n        this.BPM = 120;\n\n        this.eventQueue = []; // hold events to be triggered\n        this.queuedTime = 0.0; //\n        this.startTime = 0; // to measure time elapse\n        this.noteRegistrar = {}; // get event for requested note\n        this.onMidiEvent = undefined; // listener\n        this.frame = undefined;\n\n        this.__now = undefined;\n\n    }\n\n    start(onsuccess) {\n        if (this.currentTime < -1) {\n            this.currentTime = -1;\n        }\n        this.startAudio(this.currentTime, null, onsuccess);\n    }\n    resume(onsuccess) {\n        return this.start(onsuccess);\n    }\n\n    pause() {\n        const tmp = this.restart;\n        this.stopAudio();\n        this.restart = tmp;\n    };\n\n    stop() {\n        this.stopAudio();\n        this.restart = 0;\n        this.currentTime = 0;\n    }\n\n    addListener(onsuccess) {\n        this.onMidiEvent = onsuccess;\n    }\n\n    removeListener() {\n        this.onMidiEvent = undefined;\n    }\n    clearAnimation() {\n        if (this.animationFrameId)  {\n            cancelAnimationFrame(mthis.animationFrameId);\n        }\n    }\n    setAnimation(callback) {\n        let currentTime = 0;\n        let tOurTime = 0;\n        let tTheirTime = 0;\n        this.clearAnimation();\n        this.frame = () => {\n            this.animationFrameId = requestAnimationFrame(this.frame);\n            //\n            if (this.endTime === 0) {\n                return;\n            }\n            if (this.playing) {\n                currentTime = (tTheirTime === this.currentTime) ? tOurTime - Date.now() : 0;\n                if (this.currentTime === 0) {\n                    currentTime = 0;\n                } else {\n                    currentTime = this.currentTime - currentTime;\n                }\n                if (tTheirTime !== this.currentTime) {\n                    tOurTime = Date.now();\n                    tTheirTime = this.currentTime;\n                }\n            } else { // paused\n                currentTime = this.currentTime;\n            }\n\n            const endTime = this.endTime;\n            // const percent = currentTime / endTime;\n            const total = currentTime / 1000;\n            const minutes = total / 60;\n            const seconds = total - (minutes * 60);\n            const t1 = minutes * 60 + seconds;\n            const t2 = (endTime / 1000);\n\n            if (t2 - t1 < -1.0) {\n                // noinspection UnnecessaryReturnStatementJS\n                return;\n            } else {\n                callback({\n                    now: t1,\n                    end: t2,\n                    events: this.noteRegistrar\n                });\n            }\n        };\n\n        requestAnimationFrame(this.frame);\n    }\n\n    loadMidiFile(onsuccess, onprogress, onerror) {\n        try {\n            this.replayer = new Replayer(MidiFile(this.currentData), this.timeWarp, null, this.BPM);\n            this.data = this.replayer.getData();\n            this.endTime = this.getLength();\n\n            this.loadPlugin({\n                // instruments: this.getFileInstruments(),\n                onsuccess: onsuccess,\n                onprogress: onprogress,\n                onerror: onerror\n            });\n        } catch(event) {\n            onerror && onerror(event);\n        }\n    }\n\n    loadPlugin(...options) {  // override in subclasses\n        }\n\n    loadFile(file, onsuccess, onprogress, onerror) {\n        this.stop();\n        if (file.indexOf('base64,') !== -1) {\n            this.currentData = atob(file.split(',')[1]);\n            this.loadMidiFile(onsuccess, onprogress, onerror);\n        } else {\n            const fetch = new XMLHttpRequest();\n            fetch.open('GET', file);\n            fetch.overrideMimeType('text/plain; charset=x-user-defined');\n            fetch.onreadystatechange = () => {\n                if (fetch.readyState === 4) {\n                    if (fetch.status === 200) {\n                        const t = fetch.responseText || '';\n                        const ff = [];\n                        const mx = t.length;\n                        const scc = String.fromCharCode;\n                        for (let z = 0; z < mx; z++) {\n                            ff[z] = scc(t.charCodeAt(z) & 255);\n                        }\n\n                        this.currentData = ff.join('');\n                        this.loadMidiFile(onsuccess, onprogress, onerror);\n                    } else {\n                        onerror && onerror('Unable to load MIDI file');\n                    }\n                }\n            };\n            fetch.send();\n        }\n    }\n\n    getFileInstruments() {\n        const instruments = {};\n        const programs = {};\n        for (let n = 0; n < midi.data.length; n ++) {\n            const event = midi.data[n][0].event;\n            if (event.type !== 'channel') {\n                continue;\n            }\n            const channel = event.channel;\n            switch(event.subtype) {\n                case 'controller':\n//                  console.log(event.channel, MIDI.defineControl[event.controllerType], event.value);\n                    break;\n                case 'programChange':\n                    programs[channel] = event.programNumber;\n                    break;\n                case 'noteOn':\n                    const program = programs[channel];\n                    const gm = GM.byId[isFinite(program) ? program : channel];\n                    instruments[gm.id] = true;\n                    break;\n            }\n        }\n        const ret = [];\n        for (const key of Object.keys(instruments)) {\n            ret.push(key);\n        }\n        return ret;\n    }\n\n    // Playing the audio\n\n    scheduleTracking(channel, note, currentTime, offset, message, velocity, time) {\n        return setTimeout(() => {\n            const data = {\n                channel: channel,\n                note: note,\n                now: currentTime,\n                end: this.endTime,\n                message: message,\n                velocity: velocity\n            };\n            if (message === 128) {\n                delete this.noteRegistrar[note];\n            } else {\n                this.noteRegistrar[note] = data;\n            }\n            if (this.onMidiEvent) {\n                this.onMidiEvent(data);\n            }\n            this.currentTime = currentTime;\n            this.eventQueue.shift();\n\n            if (this.eventQueue.length < 1000) {\n                this.startAudio(this.queuedTime, true);\n            } else if (this.currentTime === this.queuedTime && this.queuedTime < this.endTime) { // grab next sequence\n                this.startAudio(this.queuedTime, true);\n            }\n        }, currentTime - offset);\n    }\n\n    getContext() {\n        if (MIDI.api === 'webaudio') {\n            return MIDI.WebAudio.getContext();\n        } else {\n            this.ctx = {currentTime: 0};\n        }\n        return this.ctx;\n    }\n\n    getLength() {\n        const data =  this.data;\n        const length = data.length;\n        let totalTime = 0.5;\n        for (let n = 0; n < length; n++) {\n            totalTime += data[n][1];\n        }\n        return totalTime;\n    }\n\n    getNow() {\n        if (window.performance && window.performance.now) {\n            return window.performance.now();\n        } else {\n            return Date.now();\n        }\n    }\n\n    startAudio(currentTime, fromCache, onsuccess) {\n        if (!this.replayer) {\n            return;\n        }\n        if (!fromCache) {\n            if (typeof currentTime === 'undefined') {\n                currentTime = this.restart;\n            }\n            this.playing && this.stopAudio();\n            this.playing = true;\n            this.data = this.replayer.getData();\n            this.endTime = this.getLength();\n        }\n\n        let note;\n        let offset = 0;\n        let messages = 0;\n        const data = this.data;\n        const ctx = this.getContext();\n        const length = data.length;\n\n        this.queuedTime = 0.5;\n\n        const interval = this.eventQueue[0] && this.eventQueue[0].interval || 0;\n        const foffset = currentTime - this.currentTime;\n\n        if (MIDI.api !== 'webaudio') { // set currentTime on ctx\n            const now = this.getNow();\n            this.__now = this.__now || now;\n            ctx.currentTime = (now - this.__now) / 1000;\n        }\n\n        this.startTime = ctx.currentTime;\n\n        for (let n = 0; n < length && messages < 100; n++) {\n            const obj = data[n];\n            if ((this.queuedTime += obj[1]) <= currentTime) {\n                offset = this.queuedTime;\n                continue;\n            }\n\n            currentTime = this.queuedTime - offset;\n\n            const event = obj[0].event;\n            if (event.type !== 'channel') {\n                continue;\n            }\n\n            const channelId = event.channel;\n            const channel = channels[channelId];\n            const delay = ctx.currentTime + ((currentTime + foffset + this.startDelay) / 1000);\n            const queueTime = this.queuedTime - offset + this.startDelay;\n            switch (event.subtype) {\n                case 'controller':\n                    MIDI.setController(channelId, event.controllerType, event.value, delay);\n                    break;\n                case 'programChange':\n                    MIDI.programChange(channelId, event.programNumber, delay);\n                    break;\n                case 'pitchBend':\n                    MIDI.pitchBend(channelId, event.value, delay);\n                    break;\n                case 'noteOn':\n                    if (channel.mute) break;\n                    note = event.noteNumber - (this.MIDIOffset || 0);\n                    this.eventQueue.push({\n                        event: event,\n                        time: queueTime,\n                        source: MIDI.noteOn(channelId, event.noteNumber, event.velocity, delay),\n                        interval: this.scheduleTracking(\n                            channelId,\n                            note,\n                            this.queuedTime + this.startDelay,\n                            offset - foffset,\n                            144,\n                            event.velocity)\n                    });\n                    messages++;\n                    break;\n                case 'noteOff':\n                    if (channel.mute) {\n                        break;\n                    }\n                    note = event.noteNumber - (this.MIDIOffset || 0);\n                    this.eventQueue.push({\n                        event: event,\n                        time: queueTime,\n                        source: MIDI.noteOff(channelId, event.noteNumber, delay),\n                        interval: this.scheduleTracking(\n                            channelId,\n                            note,\n                            this.queuedTime,\n                            offset - foffset,\n                            128,\n                            0)\n                    });\n                    break;\n                default:\n                    break;\n            }\n        }\n        //\n        onsuccess && onsuccess(this.eventQueue);\n    }\n    stopAudio() {\n        const ctx = this.getContext();\n        this.playing = false;\n        this.restart += (ctx.currentTime - this.startTime) * 1000;\n\n        // stop the audio, and intervals\n        while (this.eventQueue.length) {\n            const o = this.eventQueue.pop();\n            window.clearInterval(o.interval);\n            if (!o.source) {\n                continue; // is not webaudio\n            }\n            if (typeof(o.source) === 'number') {\n                window.clearTimeout(o.source);\n            } else { // webaudio\n                o.source.disconnect(0);\n            }\n        }\n\n        // run callback to cancel any notes still playing\n        for (let key in this.noteRegistrar) {\n            const o = this.noteRegistrar[key]\n            if (this.noteRegistrar[key].message === 144 && this.onMidiEvent) {\n                this.onMidiEvent({\n                    channel: o.channel,\n                    note: o.note,\n                    now: o.now,\n                    end: o.end,\n                    message: 128,\n                    velocity: o.velocity\n                });\n            }\n        }\n\n        // reset noteRegistrar\n        this.noteRegistrar = {};\n    }\n}\n","/*\n\t----------------------------------------------------------\n\tMIDI.Synesthesia : 0.3.1 : 2012-01-06\n\t----------------------------------------------------------\n\tPeacock:  “Instruments to perform color-music: Two centuries of technological experimentation,” Leonardo, 21 (1988), 397-406.\n\tGerstner:  Karl Gerstner, The Forms of Color 1986\n\tKlein:  Colour-Music: The art of light, London: Crosby Lockwood and Son, 1927.\n\tJameson:  “Visual music in a visual programming language,” IEEE Symposium on Visual Languages, 1999, 111-118. \n\tHelmholtz:  Treatise on Physiological Optics, New York: Dover Books, 1962 \n\tJones:  The art of light & color, New York: Van Nostrand Reinhold, 1972\n\t----------------------------------------------------------\n\tReference: http://rhythmiclight.com/archives/ideas/colorscales.html\n\t----------------------------------------------------------\n*/\n\nexport const data = {\n\t'Isaac Newton (1704)': {\n\t\tformat: 'HSL',\n\t\tref: 'Gerstner, p.167',\n\t\tenglish: ['red',null,'orange',null,'yellow','green',null,'blue',null,'indigo',null,'violet'],\n\t\t0: [ 0, 96, 51 ], // C\n\t\t1: [ 0, 0, 0 ], // C#\n\t\t2: [ 29, 94, 52 ], // D\n\t\t3: [ 0, 0, 0 ], // D#\n\t\t4: [ 60, 90, 60 ], // E\n\t\t5: [ 135, 76, 32 ], // F\n\t\t6: [ 0, 0, 0 ], // F#\n\t\t7: [ 248, 82, 28 ], // G\n\t\t8: [ 0, 0, 0 ], // G#\n\t\t9: [ 302, 88, 26 ], // A\n\t\t10: [ 0, 0, 0 ], // A#\n\t\t11: [ 325, 84, 46 ] // B\n\t},\n\t'Louis Bertrand Castel (1734)': {\n\t\tformat: 'HSL',\n\t\tref: 'Peacock, p.400',\n\t\tenglish: ['blue','blue-green','green','olive green','yellow','yellow-orange','orange','red','crimson','violet','agate','indigo'],\n\t\t0: [ 248, 82, 28 ],\n\t\t1: [ 172, 68, 34 ],\n\t\t2: [ 135, 76, 32 ],\n\t\t3: [ 79, 59, 36 ],\n\t\t4: [ 60, 90, 60 ],\n\t\t5: [ 49, 90, 60 ],\n\t\t6: [ 29, 94, 52 ],\n\t\t7: [ 360, 96, 51 ],\n\t\t8: [ 1, 89, 33 ],\n\t\t9: [ 325, 84, 46 ],\n\t\t10: [ 273, 80, 27 ],\n\t\t11: [ 302, 88, 26 ]\n\t},\n\t'George Field (1816)': {\n\t\tformat: 'HSL',\n\t\tref: 'Klein, p.69',\n\t\tenglish: ['blue',null,'purple',null,'red','orange',null,'yellow',null,'yellow green',null,'green'],\n\t\t0: [ 248, 82, 28 ],\n\t\t1: [ 0, 0, 0 ],\n\t\t2: [ 302, 88, 26 ],\n\t\t3: [ 0, 0, 0 ],\n\t\t4: [ 360, 96, 51 ],\n\t\t5: [ 29, 94, 52 ],\n\t\t6: [ 0, 0, 0 ],\n\t\t7: [ 60, 90, 60 ],\n\t\t8: [ 0, 0, 0 ],\n\t\t9: [ 79, 59, 36 ],\n\t\t10: [ 0, 0, 0 ],\n\t\t11: [ 135, 76, 32 ]\n\t},\n\t'D. D. Jameson (1844)': {\n\t\tformat: 'HSL',\n\t\tref: 'Jameson, p.12',\n\t\tenglish: ['red','red-orange','orange','orange-yellow','yellow','green','green-blue','blue','blue-purple','purple','purple-violet','violet'],\n\t\t0: [ 360, 96, 51 ],\n\t\t1: [ 14, 91, 51 ],\n\t\t2: [ 29, 94, 52 ],\n\t\t3: [ 49, 90, 60 ],\n\t\t4: [ 60, 90, 60 ],\n\t\t5: [ 135, 76, 32 ],\n\t\t6: [ 172, 68, 34 ],\n\t\t7: [ 248, 82, 28 ],\n\t\t8: [ 273, 80, 27 ],\n\t\t9: [ 302, 88, 26 ],\n\t\t10: [ 313, 78, 37 ],\n\t\t11: [ 325, 84, 46 ]\n\t},\n\t'Theodor Seemann (1881)': {\n\t\tformat: 'HSL',\n\t\tref: 'Klein, p.86',\n\t\tenglish: ['carmine','scarlet','orange','yellow-orange','yellow','green','green blue','blue','indigo','violet','brown','black'],\n\t\t0: [ 0, 58, 26 ],\n\t\t1: [ 360, 96, 51 ],\n\t\t2: [ 29, 94, 52 ],\n\t\t3: [ 49, 90, 60 ],\n\t\t4: [ 60, 90, 60 ],\n\t\t5: [ 135, 76, 32 ],\n\t\t6: [ 172, 68, 34 ],\n\t\t7: [ 248, 82, 28 ],\n\t\t8: [ 302, 88, 26 ],\n\t\t9: [ 325, 84, 46 ],\n\t\t10: [ 0, 58, 26 ],\n\t\t11: [ 0, 0, 3 ]\n\t},\n\t'A. Wallace Rimington (1893)': {\n\t\tformat: 'HSL',\n\t\tref: 'Peacock, p.402',\n\t\tenglish: ['deep red','crimson','orange-crimson','orange','yellow','yellow-green','green','blueish green','blue-green','indigo','deep blue','violet'],\n\t\t0: [ 360, 96, 51 ],\n\t\t1: [ 1, 89, 33 ],\n\t\t2: [ 14, 91, 51 ],\n\t\t3: [ 29, 94, 52 ],\n\t\t4: [ 60, 90, 60 ],\n\t\t5: [ 79, 59, 36 ],\n\t\t6: [ 135, 76, 32 ],\n\t\t7: [ 163, 62, 40 ],\n\t\t8: [ 172, 68, 34 ],\n\t\t9: [ 302, 88, 26 ],\n\t\t10: [ 248, 82, 28 ],\n\t\t11: [ 325, 84, 46 ]\n\t},\n\t'Bainbridge Bishop (1893)': {\n\t\tformat: 'HSL',\n\t\tref: 'Bishop, p.11',\n\t\tenglish: ['red','orange-red or scarlet','orange','gold or yellow-orange','yellow or green-gold','yellow-green','green','greenish-blue or aquamarine','blue','indigo or violet-blue','violet','violet-red','red'],\n\t\t0: [ 360, 96, 51 ],\n\t\t1: [ 1, 89, 33 ],\n\t\t2: [ 29, 94, 52 ],\n\t\t3: [ 50, 93, 52 ],\n\t\t4: [ 60, 90, 60 ],\n\t\t5: [ 73, 73, 55 ],\n\t\t6: [ 135, 76, 32 ],\n\t\t7: [ 163, 62, 40 ],\n\t\t8: [ 302, 88, 26 ],\n\t\t9: [ 325, 84, 46 ],\n\t\t10: [ 343, 79, 47 ],\n\t\t11: [ 360, 96, 51 ]\n\t},\n\t'H. von Helmholtz (1910)': {\n\t\tformat: 'HSL',\n\t\tref: 'Helmholtz, p.22',\n\t\tenglish: ['yellow','green','greenish blue','cayan-blue','indigo blue','violet','end of red','red','red','red','red orange','orange'],\n\t\t0: [ 60, 90, 60 ],\n\t\t1: [ 135, 76, 32 ],\n\t\t2: [ 172, 68, 34 ],\n\t\t3: [ 211, 70, 37 ],\n\t\t4: [ 302, 88, 26 ],\n\t\t5: [ 325, 84, 46 ],\n\t\t6: [ 330, 84, 34 ],\n\t\t7: [ 360, 96, 51 ],\n\t\t8: [ 10, 91, 43 ],\n\t\t9: [ 10, 91, 43 ],\n\t\t10: [ 8, 93, 51 ],\n\t\t11: [ 28, 89, 50 ]\n\t},\n\t'Alexander Scriabin (1911)': {\n\t\tformat: 'HSL',\n\t\tref: 'Jones, p.104',\n\t\tenglish: ['red','violet','yellow','steely with the glint of metal','pearly blue the shimmer of moonshine','dark red','bright blue','rosy orange','purple','green','steely with a glint of metal','pearly blue the shimmer of moonshine'],\n\t\t0: [ 360, 96, 51 ],\n\t\t1: [ 325, 84, 46 ],\n\t\t2: [ 60, 90, 60 ],\n\t\t3: [ 245, 21, 43 ],\n\t\t4: [ 211, 70, 37 ],\n\t\t5: [ 1, 89, 33 ],\n\t\t6: [ 248, 82, 28 ],\n\t\t7: [ 29, 94, 52 ],\n\t\t8: [ 302, 88, 26 ],\n\t\t9: [ 135, 76, 32 ],\n\t\t10: [ 245, 21, 43 ],\n\t\t11: [ 211, 70, 37 ]\n\t},\n\t'Adrian Bernard Klein (1930)': {\n\t\tformat: 'HSL',\n\t\tref: 'Klein, p.209',\n\t\tenglish: ['dark red','red','red orange','orange','yellow','yellow green','green','blue-green','blue','blue violet','violet','dark violet'],\n\t\t0: [ 0, 91, 40 ],\n\t\t1: [ 360, 96, 51 ],\n\t\t2: [ 14, 91, 51 ],\n\t\t3: [ 29, 94, 52 ],\n\t\t4: [ 60, 90, 60 ],\n\t\t5: [ 73, 73, 55 ],\n\t\t6: [ 135, 76, 32 ],\n\t\t7: [ 172, 68, 34 ],\n\t\t8: [ 248, 82, 28 ],\n\t\t9: [ 292, 70, 31 ],\n\t\t10: [ 325, 84, 46 ],\n\t\t11: [ 330, 84, 34 ]\n\t},\n\t'August Aeppli (1940)': {\n\t\tformat: 'HSL',\n\t\tref: 'Gerstner, p.169',\n\t\tenglish: ['red',null,'orange',null,'yellow',null,'green','blue-green',null,'ultramarine blue','violet','purple'],\n\t\t0: [ 0, 96, 51 ],\n\t\t1: [ 0, 0, 0 ],\n\t\t2: [ 29, 94, 52 ],\n\t\t3: [ 0, 0, 0 ],\n\t\t4: [ 60, 90, 60 ],\n\t\t5: [ 0, 0, 0 ],\n\t\t6: [ 135, 76, 32 ],\n\t\t7: [ 172, 68, 34 ],\n\t\t8: [ 0, 0, 0 ],\n\t\t9: [ 211, 70, 37 ],\n\t\t10: [ 273, 80, 27 ],\n\t\t11: [ 302, 88, 26 ]\n\t},\n\t'I. J. Belmont (1944)': {\n\t\tref: 'Belmont, p.226',\n\t\tenglish: ['red','red-orange','orange','yellow-orange','yellow','yellow-green','green','blue-green','blue','blue-violet','violet','red-violet'],\n\t\t0: [ 360, 96, 51 ],\n\t\t1: [ 14, 91, 51 ],\n\t\t2: [ 29, 94, 52 ],\n\t\t3: [ 50, 93, 52 ],\n\t\t4: [ 60, 90, 60 ],\n\t\t5: [ 73, 73, 55 ],\n\t\t6: [ 135, 76, 32 ],\n\t\t7: [ 172, 68, 34 ],\n\t\t8: [ 248, 82, 28 ],\n\t\t9: [ 313, 78, 37 ],\n\t\t10: [ 325, 84, 46 ],\n\t\t11: [ 338, 85, 37 ]\n\t},\n\t'Steve Zieverink (2004)': {\n\t\tformat: 'HSL',\n\t\tref: 'Cincinnati Contemporary Art Center',\n\t\tenglish: ['yellow-green','green','blue-green','blue','indigo','violet','ultra violet','infra red','red','orange','yellow-white','yellow'],\n\t\t0: [ 73, 73, 55 ],\n\t\t1: [ 135, 76, 32 ],\n\t\t2: [ 172, 68, 34 ],\n\t\t3: [ 248, 82, 28 ],\n\t\t4: [ 302, 88, 26 ],\n\t\t5: [ 325, 84, 46 ],\n\t\t6: [ 326, 79, 24 ],\n\t\t7: [ 1, 89, 33 ],\n\t\t8: [ 360, 96, 51 ],\n\t\t9: [ 29, 94, 52 ],\n\t\t10: [ 62, 78, 74 ],\n\t\t11: [ 60, 90, 60 ]\n\t},\n\t'Circle of Fifths (Johnston 2003)': {\n\t\tformat: 'RGB',\n\t\tref: 'Joseph Johnston',\n\t\tenglish: ['yellow', 'blue', 'orange', 'teal', 'red', 'green', 'purple', 'light orange', 'light blue', 'dark orange', 'dark green', 'violet' ],\n\t\t0: [ 255, 255, 0 ],\n\t\t1: [ 50, 0, 255 ],\n\t\t2: [ 255, 150, 0 ],\n\t\t3: [ 0, 210, 180 ],\n\t\t4: [ 255, 0, 0 ],\n\t\t5: [ 130, 255, 0 ],\n\t\t6: [ 150, 0, 200 ],\n\t\t7: [ 255, 195, 0 ],\n\t\t8: [ 30, 130, 255 ],\n\t\t9: [ 255, 100, 0 ],\n\t\t10: [ 0, 200, 0 ],\n\t\t11: [ 225, 0, 225 ]\n\t},\n\t'Circle of Fifths (Wheatman 2002)': {\n\t\tformat: 'HEX',\n\t\tref: 'Stuart Wheatman', // http://www.valleysfamilychurch.org/\n\t\tenglish: [],\n\t\tdata: ['#122400', '#2E002E', '#002914', '#470000', '#002142', '#2E2E00', '#290052', '#003D00', '#520029', '#003D3D', '#522900', '#000080', '#244700', '#570057', '#004D26', '#7A0000', '#003B75', '#4C4D00', '#47008F', '#006100', '#850042', '#005C5C', '#804000', '#0000C7', '#366B00', '#80007F', '#00753B', '#B80000', '#0057AD', '#6B6B00', '#6600CC', '#008A00', '#B8005C', '#007F80', '#B35900', '#2424FF', '#478F00', '#AD00AD', '#00994D', '#F00000', '#0073E6', '#8F8F00', '#8A14FF', '#00AD00', '#EB0075', '#00A3A3', '#E07000', '#6B6BFF', '#5CB800', '#DB00DB', '#00C261', '#FF5757', '#3399FF', '#ADAD00', '#B56BFF', '#00D600', '#FF57AB', '#00C7C7', '#FF9124', '#9999FF', '#6EDB00', '#FF29FF', '#00E070', '#FF9999', '#7ABDFF', '#D1D100', '#D1A3FF', '#00FA00', '#FFA3D1', '#00E5E6', '#FFC285', '#C2C2FF', '#80FF00', '#FFA8FF', '#00E070', '#FFCCCC', '#C2E0FF', '#F0F000', '#EBD6FF', '#ADFFAD', '#FFD6EB', '#8AFFFF', '#FFEBD6', '#EBEBFF', '#E0FFC2', '#FFEBFF', '#E5FFF2', '#FFF5F5']\t\t}\n};\n\nexport const map = type => {\n\tconst data_internal = {};\n\tconst blend = (a, b) => {\n\t\treturn [ // blend two colors and round results\n\t\t\t(a[0] * 0.5 + b[0] * 0.5 + 0.5) >> 0,\n\t\t\t(a[1] * 0.5 + b[1] * 0.5 + 0.5) >> 0,\n\t\t\t(a[2] * 0.5 + b[2] * 0.5 + 0.5) >> 0\n\t\t];\n\t};\n\n\tconst syn = data;\n\tconst colors = syn[type] || syn['D. D. Jameson (1844)'];\n\tlet prior_clr = colors[3];\n\tlet H, S, L;\n\tfor (let note = 0; note <= 88; note++) { // creates mapping for 88 notes\n\t\tif (colors.data) {\n\t\t\tdata_internal[note] = {\n\t\t\t\thsl: colors.data[note],\n\t\t\t\thex: colors.data[note]\n\t\t\t};\n\t\t} else {\n\t\t\tlet clr = colors[(note + 9) % 12];\n\n\t\t\tswitch(colors.format) {\n\t\t\t\tcase 'RGB':\n\t\t\t\t\tclr = Color.Space(clr, 'RGB>HSL');\n\t\t\t\t\tH = clr.H >> 0;\n\t\t\t\t\tS = clr.S >> 0;\n\t\t\t\t\tL = clr.L >> 0;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'HSL':\n\t\t\t\t\tH = clr[0];\n\t\t\t\t\tS = clr[1];\n\t\t\t\t\tL = clr[2];\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (H === S && S === L) { // note color is unset\n\t\t\t\tclr = blend(prior_clr, colors[(note + 10) % 12]);\n\t\t\t}\n\n\t\t\t// \tvar amount = L / 10;\n\t\t\t// \tvar octave = note / 12 >> 0;\n\t\t\t// \tvar octaveLum = L + amount * octave - 3.0 * amount; // map luminance to octave\n\n\t\t\tdata_internal[note] = {\n\t\t\t\thsl: 'hsla(' + H + ',' + S + '%,' + L + '%, 1)',\n\t\t\t\thex: Color.Space({H: H, S: S, L: L}, 'HSL>RGB>HEX>W3')\n\t\t\t};\n\n\t\t\tprior_clr = clr;\n\t\t}\n\t}\n\treturn data_internal;\n};\n","/*\n\t----------------------------------------------------------\n\tMIDI.Plugin : 0.3.4 : 2015-03-26\n\t----------------------------------------------------------\n\thttps://github.com/mudcube/MIDI.js\n\t----------------------------------------------------------\n\tInspired by javax.sound.midi (albeit a super simple version): \n\t\thttp://docs.oracle.com/javase/6/docs/api/javax/sound/midi/package-summary.html\n\t----------------------------------------------------------\n\tTechnologies\n\t----------------------------------------------------------\n\t\tWeb MIDI API - no native support yet (jazzplugin)\n\t\tWeb Audio API - firefox 25+, chrome 10+, safari 6+, opera 15+\n\t\tHTML5 Audio Tag - ie 9+, firefox 3.5+, chrome 4+, safari 4+, opera 9.5+, ios 4+, android 2.3+\n\t----------------------------------------------------------\n*/\nimport './shim/WebAudioAPI.js';  // imported by default -- webmidi shim needs to be loaded separately\nimport { audioDetect } from './audioDetect.js';\nimport * as AudioTag from './plugin.audiotag.js';\nimport * as WebAudio from './plugin.webaudio.js';\nimport * as WebMIDI from './plugin.webmidi.js';\nexport { GM, noteToKey, keyToNote } from './gm.js';\nimport { PlayInstance } from './player.js';\nexport * as Synesthesia from './synesthesia.js';\n\nexport const Soundfont = {};\n\nexport const audio_contexts = {\n\tAudioTag,\n\tWebAudio,\n\tWebMIDI,\n};\n\nexport const config = {\n\tsoundfontUrl: './soundfont/',\n\tapi: undefined,\n\taudioFormat: undefined,\n\tsupports: {},\n\tconnected_plugin: undefined,\n};\n\n\n/*\nMIDI.loadPlugin({\n\tonsuccess: function() { },\n\tonprogress: function(state, percent) { },\n\ttargetFormat: 'mp3', // optionally can force to use MP3 (for instance on mobile networks)\n\tinstrument: 'acoustic_grand_piano', // or 1 (default)\n\tinstruments: [ 'acoustic_grand_piano', 'acoustic_guitar_nylon' ] // or multiple instruments\n});\n*/\n\nexport const loadPlugin = opts => {\n\tif (typeof opts === 'function') {\n\t\topts = {\n\t\t\tonsuccess: opts\n\t\t};\n\t}\n\topts.onprogress = opts.onprogress || undefined;\n\topts.api = opts.api || '';\n\topts.targetFormat = opts.targetFormat || '';\n\topts.instrument = opts.instrument || 'acoustic_grand_piano';\n\topts.instruments = opts.instruments || undefined;\n\t// MSC: add the order of API precedence.\n\t//      Chrome's need for sys permissions for webmidi makes it lower precedence.\n\topts.apiPrecedence = opts.apiPrecedence || ['webaudio', 'webmidi', 'audiotag'];\n\n\tconfig.soundfontUrl = opts.soundfontUrl || config.soundfontUrl;\n\n\t// Detect the best type of audio to use\n\taudioDetect(supports => {\n\t\tconst hash = window.location.hash;\n\t\tlet api = '';\n\n\t\t// use the most appropriate plugin if not specified\n\t\tif (supports[opts.api]) {\n\t\t\tapi = opts.api;\n\t\t} else if (supports[hash.substr(1)]) {\n\t\t\tapi = hash.substr(1);\n\t\t} else {\n\t\t\tfor (const apiInOrder of opts.apiPrecedence) {\n\t\t\t\tif (supports[apiInOrder]) {\n\t\t\t\t\tapi = apiInOrder;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (connect[api]) {\n\t\t\tlet audioFormat;\n\t\t\t// use audio/ogg when supported\n\t\t\tif (opts.targetFormat) {\n\t\t\t\taudioFormat = opts.targetFormat;\n\t\t\t} else { // use best quality\n\t\t\t\taudioFormat = supports['audio/ogg'] ? 'ogg' : 'mp3';\n\t\t\t}\n\n\t\t\t// load the specified plugin\n\t\t\tconfig.api = api;\n\t\t\tconfig.audioFormat = audioFormat;\n\t\t\tconfig.supports = supports;\n\t\t\tloadProgram(opts);\n\t\t}\n\t});\n};\n\n/*\n\tloadProgram({\n\t\tinstrument: 'banjo'\n\t\tonsuccess: function() { },\n\t\tonprogress: function(state, percent) { },\n\t\tonerror: function() { },\n\t})\n*/\n\nexport const loadProgram = opts => {\n\tlet instruments = opts.instruments || opts.instrument || 'acoustic_grand_piano';\n\t//\n\tif (typeof instruments !== 'object') {\n\t\tif (instruments || instruments === 0) {\n\t\t\tinstruments = [instruments];\n\t\t} else {\n\t\t\tinstruments = [];\n\t\t}\n\t}\n\t// convert numeric ids into strings\n\tfor (let i = 0; i < instruments.length; i ++) {\n\t\tconst instrument = instruments[i];\n\t\tif (instrument === (instrument + 0)) { // is numeric\n\t\t\tif (GM.byId[instrument]) {\n\t\t\t\tinstruments[i] = GM.byId[instrument].id;\n\t\t\t}\n\t\t}\n\t}\n\t//\n\topts.format = config.audioFormat;\n\topts.instruments = instruments;\n\t//\n\tconnect[config.api](opts);\n};\n\nconst connect = {\n\twebmidi: opts => {\n\t\t// cant wait for this to be standardized!\n\t\tpre_connect(WebMIDI, opts);\n\t\tWebMIDI.connect(opts);\n\t},\n\taudiotag: opts => {\n\t\t// works ok, kinda like a drunken tuna fish, across the board\n\t\t// http://caniuse.com/audio\n\t\tpre_connect(AudioTag, opts);\n\t\trequestQueue(opts, 'AudioTag');\n\t},\n\twebaudio: opts => {\n\t\t// works awesome! safari, chrome and firefox support\n\t\t// http://caniuse.com/web-audio\n\t\tpre_connect(WebAudio, opts);\n\t\trequestQueue(opts, 'WebAudio');\n\t}\n};\n\nconst pre_connect = (plugin, opts) => {\n\tconfig.connected_plugin = plugin;\n\tplugin.shared_root_info.Soundfont = Soundfont;\n\tplugin.shared_root_info.config = config;\n\tplugin.shared_root_info.webaudio_backup_connect = opts => connect['webaudio'](opts);\n}\n\nexport const requestQueue = (opts, context) => {\n\tconst audioFormat = opts.format;\n\tconst instruments = opts.instruments;\n\tconst onprogress = opts.onprogress;\n\tconst onerror = opts.onerror;\n\tconst correct_audio_context = audio_contexts[context] || context.WebAudio;\n\n\tconst num_instruments = instruments.length;\n\tlet pending = num_instruments;\n\tconst waitForEnd = () => {\n\t\tpending -= 1;\n\t\tif (!pending) {\n\t\t\tonprogress && onprogress('load', 1.0);\n\t\t\tcorrect_audio_context.connect(opts);\n\t\t}\n\t};\n\n\tfor (const instrumentId of instruments) {\n\t\tif (Soundfont[instrumentId]) { // already loaded\n\t\t\twaitForEnd();\n\t\t} else { // needs to be requested\n\t\t\tconst onprogress_inner = (evt, progress) => {\n\t\t\t\tconst fileProgress = progress / num_instruments;\n\t\t\t\tconst queueProgress = (num_instruments - pending) / num_instruments;\n\t\t\t\tonprogress && onprogress('load', fileProgress + queueProgress, instrumentId);\n\t\t\t}\n\t\t\tconst onsuccess_inner = () => waitForEnd();\n\t\t\tsendRequest(instrumentId, audioFormat, onprogress_inner, onsuccess_inner, onerror);\n\t\t}\n\t};\n};\n\nexport const sendRequest = (instrumentId, audioFormat, onprogress, onsuccess, onerror) => {\n\tconst soundfontPath = config.soundfontUrl + instrumentId + '-' + audioFormat + '.js';\n\tconst xhr = new XMLHttpRequest();\n\txhr.open('GET', soundfontPath);\n\txhr.setRequestHeader('Content-Type', 'text/plain');\n\txhr.onload = () => {\n\t\tif (xhr.status === 200) {\n\t\t\tconst script = document.createElement('script');\n\t\t\tscript.language = 'javascript';\n\t\t\tscript.type = 'text/javascript';\n\t\t\t// console.log(xhr.responseText);\n\t\t\tscript.text = xhr.responseText;\n\t\t\tdocument.body.appendChild(script);\n\t\t\tonsuccess();\n\t\t} else {\n\t\t\tonerror();\n\t\t}\n\t};\n\txhr.send();\n};\n\nexport const playChannel = (...options) => {\n\treturn config.connected_plugin.playChannel(...options);\n}\n\nexport const stopChannel = (...options) => {\n\treturn config.connected_plugin.stopChannel(...options);\n}\n\n// TODO: audioBuffers\n\nexport const send = (...options) => {\n\treturn config.connected_plugin.send(...options);\n}\nexport const setController = (...options) => {\n\treturn config.connected_plugin.setController(...options);\n}\nexport const setVolume = (...options) => {\n\treturn config.connected_plugin.setVolume(...options);\n}\nexport const programChange = (...options) => {\n\treturn config.connected_plugin.programChange(...options);\n}\nexport const pitchBend = (...options) => {\n\treturn config.connected_plugin.pitchBend(...options);\n}\nexport const noteOn = (...options) => {\n\treturn config.connected_plugin.noteOn(...options);\n}\nexport const noteOff = (...options) => {\n\treturn config.connected_plugin.noteOff(...options);\n}\n\nexport const chordOn = (...options) => {\n\treturn config.connected_plugin.chordOn(...options);\n}\n\nexport const chordOff = (...options) => {\n\treturn config.connected_plugin.chordOff(...options);\n}\n\nexport const stopAllNotes = (...options) => {\n\treturn config.connected_plugin.stopAllNotes(...options);\n}\n\n\nexport const setEffects = (...options) => {\n\tif (config.connected_plugin !== WebAudio) {\n\t\treturn;\n\t}\n\treturn config.connected_plugin.setEffects();\n}\n\nexport const getContext = () => {\n\tif (config.connected_plugin !== WebAudio) {\n\t\treturn;\n\t}\n\treturn config.connected_plugin.getContext();\n}\n\n\nexport const setContext = (...options) => {\n\tif (config.connected_plugin !== WebAudio) {\n\t\treturn;\n\t}\n\treturn config.connected_plugin.setContext(...options);\n}\n\n\n// Player\n\nexport class Player extends PlayInstance {\n\tconstructor() {\n\t\tsuper(config.connected_plugin);\n\t}\n\tloadPlugin(...options) {\n\t\treturn loadPlugin(...options);\n\t}\n}\n"],"sourceRoot":""}