!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("MIDI",[],t):"object"==typeof exports?exports.MIDI=t():e.MIDI=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t){var n,r,o,i,a;
/**
 * @license -------------------------------------------------------------------
 *   module: WebAudioShim - Fix naming issues for WebAudioAPI supports
 *      src: https://github.com/Dinahmoe/webaudioshim
 *   author: Dinahmoe AB
 * -------------------------------------------------------------------
 * Copyright (c) 2012 DinahMoe AB
 * 
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 * 
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 */
window.AudioContext=window.AudioContext||window.webkitAudioContext||null,window.OfflineAudioContext=window.OfflineAudioContext||window.webkitOfflineAudioContext||null,n=window.AudioContext,(a=function(e){return"[object Function]"===Object.prototype.toString.call(e)||"[object AudioContextConstructor]"===Object.prototype.toString.call(e)})(n)&&(o=new n).destination&&o.sampleRate&&(r=n.prototype,i=Object.getPrototypeOf(o.createBufferSource()),a(i.start)||a(i.noteOn)&&(i.start=function(e,t,n){switch(arguments.length){case 0:throw new Error("Not enough arguments.");case 1:this.noteOn(e);break;case 2:if(!this.buffer)throw new Error("Missing AudioBuffer");this.noteGrainOn(e,t,this.buffer.duration-t);break;case 3:this.noteGrainOn(e,t,n)}}),a(i.noteOn)||(i.noteOn=i.start),a(i.noteGrainOn)||(i.noteGrainOn=i.start),a(i.stop)||(i.stop=i.noteOff),a(i.noteOff)||(i.noteOff=i.stop),[["createGainNode","createGain"],["createDelayNode","createDelay"],["createJavaScriptNode","createScriptProcessor"]].forEach(function(e){for(var t,n;e.length;)t=e.pop(),a(this[t])?this[e.pop()]=this[t]:(n=e.pop(),this[t]=this[n])},r))},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"shared_root_info",function(){return y}),n.d(r,"playChannel",function(){return F}),n.d(r,"stopChannel",function(){return k}),n.d(r,"send",function(){return T}),n.d(r,"setController",function(){return x}),n.d(r,"setVolume",function(){return C}),n.d(r,"programChange",function(){return E}),n.d(r,"pitchBend",function(){return B}),n.d(r,"noteOn",function(){return I}),n.d(r,"noteOff",function(){return O}),n.d(r,"chordOn",function(){return M}),n.d(r,"chordOff",function(){return D}),n.d(r,"stopAllNotes",function(){return K}),n.d(r,"connect",function(){return U});var o={};n.r(o),n.d(o,"shared_root_info",function(){return j}),n.d(o,"send",function(){return L}),n.d(o,"setController",function(){return Y}),n.d(o,"setVolume",function(){return _}),n.d(o,"programChange",function(){return H}),n.d(o,"pitchBend",function(){return Q}),n.d(o,"noteOn",function(){return X}),n.d(o,"noteOff",function(){return z}),n.d(o,"chordOn",function(){return $}),n.d(o,"chordOff",function(){return ee}),n.d(o,"stopAllNotes",function(){return te}),n.d(o,"setEffects",function(){return ne}),n.d(o,"connect",function(){return re}),n.d(o,"getContext",function(){return oe}),n.d(o,"setContext",function(){return ie}),n.d(o,"loadAudio",function(){return ae}),n.d(o,"createAudioContext",function(){return ue});var i={};n.r(i),n.d(i,"shared_root_info",function(){return se}),n.d(i,"send",function(){return le}),n.d(i,"setController",function(){return fe}),n.d(i,"setVolume",function(){return de}),n.d(i,"programChange",function(){return pe}),n.d(i,"pitchBend",function(){return he}),n.d(i,"noteOn",function(){return ve}),n.d(i,"noteOff",function(){return ye}),n.d(i,"chordOn",function(){return me}),n.d(i,"chordOff",function(){return ge}),n.d(i,"stopAllNotes",function(){return Ae}),n.d(i,"connect",function(){return be});var a={};n.r(a),n.d(a,"data",function(){return Be}),n.d(a,"map",function(){return Ie});n(0);var u={},s=0,c=function(e){s+=1;var t=document.body,n=new Audio,r=e.split(";")[0];n.id="audio",n.setAttribute("preload","auto"),n.setAttribute("audiobuffer",!0),n.addEventListener("error",function(){t.removeChild(n),u[r]=!1,s-=1},!1),n.addEventListener("canplaythrough",function(){t.removeChild(n),u[r]=!0,s-=1},!1),n.src="data:"+e,t.appendChild(n)};function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var f=function(e){for(var t=function(e){return e.replace(/[^a-z0-9 ]/gi,"").replace(/[ ]/g,"_").toLowerCase()},n={byName:{},byId:{},byCategory:{}},r=0,o=Object.entries(e);r<o.length;r++){var i=l(o[r],2),a=i[0],u=i[1],s=!0,c=!1,f=void 0;try{for(var d,p=u[Symbol.iterator]();!(s=(d=p.next()).done);s=!0){var h=d.value;if(h){var v=parseInt(h.substr(0,h.indexOf(" ")),10),y=v-1,m=h.replace(v+" ",""),g=t(m),A=t(a),b={id:g,name:m,program:y,category:a};n.byId[y]=b,n.byName[g]=b,n.byCategory[A]=n.byCategory[A]||[],n.byCategory[A].push(b)}}}catch(e){c=!0,f=e}finally{try{s||null==p.return||p.return()}finally{if(c)throw f}}}return n}({Piano:["1 Acoustic Grand Piano","2 Bright Acoustic Piano","3 Electric Grand Piano","4 Honky-tonk Piano","5 Electric Piano 1","6 Electric Piano 2","7 Harpsichord","8 Clavinet"],"Chromatic Percussion":["9 Celesta","10 Glockenspiel","11 Music Box","12 Vibraphone","13 Marimba","14 Xylophone","15 Tubular Bells","16 Dulcimer"],Organ:["17 Drawbar Organ","18 Percussive Organ","19 Rock Organ","20 Church Organ","21 Reed Organ","22 Accordion","23 Harmonica","24 Tango Accordion"],Guitar:["25 Acoustic Guitar (nylon)","26 Acoustic Guitar (steel)","27 Electric Guitar (jazz)","28 Electric Guitar (clean)","29 Electric Guitar (muted)","30 Overdriven Guitar","31 Distortion Guitar","32 Guitar Harmonics"],Bass:["33 Acoustic Bass","34 Electric Bass (finger)","35 Electric Bass (pick)","36 Fretless Bass","37 Slap Bass 1","38 Slap Bass 2","39 Synth Bass 1","40 Synth Bass 2"],Strings:["41 Violin","42 Viola","43 Cello","44 Contrabass","45 Tremolo Strings","46 Pizzicato Strings","47 Orchestral Harp","48 Timpani"],Ensemble:["49 String Ensemble 1","50 String Ensemble 2","51 Synth Strings 1","52 Synth Strings 2","53 Choir Aahs","54 Voice Oohs","55 Synth Choir","56 Orchestra Hit"],Brass:["57 Trumpet","58 Trombone","59 Tuba","60 Muted Trumpet","61 French Horn","62 Brass Section","63 Synth Brass 1","64 Synth Brass 2"],Reed:["65 Soprano Sax","66 Alto Sax","67 Tenor Sax","68 Baritone Sax","69 Oboe","70 English Horn","71 Bassoon","72 Clarinet"],Pipe:["73 Piccolo","74 Flute","75 Recorder","76 Pan Flute","77 Blown Bottle","78 Shakuhachi","79 Whistle","80 Ocarina"],"Synth Lead":["81 Lead 1 (square)","82 Lead 2 (sawtooth)","83 Lead 3 (calliope)","84 Lead 4 (chiff)","85 Lead 5 (charang)","86 Lead 6 (voice)","87 Lead 7 (fifths)","88 Lead 8 (bass + lead)"],"Synth Pad":["89 Pad 1 (new age)","90 Pad 2 (warm)","91 Pad 3 (polysynth)","92 Pad 4 (choir)","93 Pad 5 (bowed)","94 Pad 6 (metallic)","95 Pad 7 (halo)","96 Pad 8 (sweep)"],"Synth Effects":["97 FX 1 (rain)","98 FX 2 (soundtrack)","99 FX 3 (crystal)","100 FX 4 (atmosphere)","101 FX 5 (brightness)","102 FX 6 (goblins)","103 FX 7 (echoes)","104 FX 8 (sci-fi)"],Ethnic:["105 Sitar","106 Banjo","107 Shamisen","108 Koto","109 Kalimba","110 Bagpipe","111 Fiddle","112 Shanai"],Percussive:["113 Tinkle Bell","114 Agogo","115 Steel Drums","116 Woodblock","117 Taiko Drum","118 Melodic Tom","119 Synth Drum"],"Sound effects":["120 Reverse Cymbal","121 Guitar Fret Noise","122 Breath Noise","123 Seashore","124 Bird Tweet","125 Telephone Ring","126 Helicopter","127 Applause","128 Gunshot"]}),d=function(){for(var e={},t=0;t<16;t++)e[t]={program:t,pitchBend:0,mute:!1,mono:!1,omni:!1,solo:!1};return e}(),p={},h={};function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){for(var e=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],t=21;t<=108;t++){var n=e[t%12]+((t-12)/12>>0);p[n]=t,h[t]=n}}();for(var y={},m=[],g=0;g<16;g++)m[g]=127;for(var A=-1,b=[],q={},w=[],S=0;S<12;S++)w[S]=new Audio;var F=function(e,t){if(d[e]){var n=d[e].program,r=f.byId[n].id,o=q[t];if(o){var i=r+""+o.id,a=(A+1)%w.length,u=w[a];if(b[a]=i,!y.Soundfont[r])return void console.log("404",r);u.src=y.Soundfont[r][o.id],u.volume=m[e]/127,u.play(),A=a}}},k=function(e,t){if(d[e]){var n=d[e].program,r=f.byId[n].id,o=q[t];if(o)for(var i=r+""+o.id,a=0,u=w.length;a<u;a++){var s=(a+A+1)%u,c=b[s];if(c&&c===i)return w[s].pause(),void(b[s]=null)}}},T=function(e,t){},x=function(e,t,n,r){},C=function(e,t){m[e]=t},E=function(e,t){d[e].instrument=t},B=function(e,t,n){},I=function(e,t,n,r){var o=h[t];if(q[o])return r?setTimeout(function(){m[e]=n,F(e,o)},1e3*r):(m[e]=n,void F(e,o))},O=function(e,t,n){},M=function(e,t,n,r){for(var o=function(n){var o=t[n],i=h[o];return q[i]?r?{v:setTimeout(function(){F(e,i)},1e3*r)}:void F(e,i):"continue"},i=0;i<t.length;i++){var a=o(i);switch(a){case"continue":continue;default:if("object"===v(a))return a.v}}},D=function(e,t,n){for(var r=function(r){var o=t[r],i=h[o];return q[i]?n?{v:setTimeout(function(){k(e,i)},1e3*n)}:void k(e,i):"continue"},o=0;o<t.length;o++){var i=r(o);switch(i){case"continue":continue;default:if("object"===v(i))return i.v}}},K=function(){for(var e=0,t=w.length;e<t;e++)w[e].pause()},U=function(e){for(var t in p)q[t]={id:t};e.onsuccess&&e.onsuccess()},J="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function R(e){var t=Math.ceil(3*e.length/4),n=new ArrayBuffer(t);return function(e,t){var n,r,o,i,a,u,s,c,l=J.indexOf(e.charAt(e.length-1)),f=J.indexOf(e.charAt(e.length-1)),d=Math.ceil(3*e.length/4);64===l&&d--;64===f&&d--;var p=0;n=t?new Uint8Array(t):new Uint8Array(d);e=e.replace(/[^A-Za-z0-9+\/=]/g,"");for(var h=0;h<d;h+=3)a=J.indexOf(e.charAt(p++)),u=J.indexOf(e.charAt(p++)),s=J.indexOf(e.charAt(p++)),c=J.indexOf(e.charAt(p++)),r=a<<2|u>>4,o=(15&u)<<4|s>>2,i=(3&s)<<6|c,n[h]=r,64!==s&&(n[h+1]=o),64!==c&&(n[h+2]=i)}(e,n),n}function W(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var P,j={},N={},G={},V=127,Z={},L=function(e,t){},Y=function(e,t,n,r){},_=function(e,t,n){n?setTimeout(function(){V=t},1e3*n):V=t},H=function(e,t,n){var r=d[e];r&&(r.program=t)},Q=function(e,t,n){var r=d[e];r&&(n?setTimeout(function(){return r.pitchBend=t},n):r.pitchBend=t)},X=function(e,t,n,r){r=r||0;var o=d[e].program,i=Z[o+"x"+t];if(i){var a;if(r<P.currentTime&&(r+=P.currentTime),(a=P.createBufferSource()).buffer=i,G){var u=a;for(var s in G)u.connect(G[s].input),u=G[s]}var c=n/127*(V/127)*2-1;return a.connect(P.destination),a.playbackRate.value=1,a.gainNode=P.createGain(),a.gainNode.connect(P.destination),a.gainNode.gain.value=Math.min(1,Math.max(-1,c)),a.connect(a.gainNode),a.start(r||0),N[e+"x"+t]=a,a}console.log("no buffer",f.byId[o].id,o,e)},z=function(e,t,n){n=n||0;var r=d[e].program,o=Z[r+"x"+t];if(o){n<P.currentTime&&(n+=P.currentTime);var i=N[e+"x"+t];if(i){if(i.gainNode){var a=i.gainNode.gain;a.linearRampToValueAtTime(a.value,n),a.linearRampToValueAtTime(-1,n+.3)}return i.noteOff?i.noteOff(n+.5):i.stop(n+.5),delete N[e+"x"+t],i}}},$=function(e,t,n,r){var o={},i=!0,a=!1,u=void 0;try{for(var s,c=t[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var l=s.value;o[l]=X(e,l,n,r)}}catch(e){a=!0,u=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw u}}return o},ee=function(e,t,n){var r={},o=!0,i=!1,a=void 0;try{for(var u,s=t[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var c=u.value;r[c]=z(e,c,n)}}catch(e){i=!0,a=e}finally{try{o||null==s.return||s.return()}finally{if(i)throw a}}return r},te=function(){for(var e in N){var t=0;t<P.currentTime&&(t+=P.currentTime);var n=N[e];n.gain.linearRampToValueAtTime(1,t),n.gain.linearRampToValueAtTime(0,t+.3),n.noteOff?n.noteOff(t+.3):n.stop(t+.3),delete N[e]}},ne=function(e){if(!P||!P.tunajs)return console.log("Effects module not installed.");var t=!0,n=!1,r=void 0;try{for(var o,i=e[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value,u=new P.tunajs[a.type](a);u.connect(P.destination),G[a.type]=u}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}},re=function(e){ie(P||ue(),e.onsuccess)},oe=function(){return P},ie=function(e,t,n,r){P=e,"undefined"==typeof Tuna||P.tunajs instanceof Tuna||(P.tunajs=new Tuna(P));var o=[];for(var i in p)o.push(i);for(var a=function(e){for(var n=0,r=Object.keys(s);n<r.length;n++){var o=r[n];if(s[o])return}t&&(t(),t=null)},u=function(e,t,n,r){var o=e[r];o&&(s[t]++,ae(o,function(o){o.id=r;var i=p[r];if(Z[t+"x"+i]=o,0==--s[t]){var u=n/87;console.log(f.byId[t],"processing: ",u),e.isLoaded=!0,a()}},function(e){console.log(e)}))},s={},c=0,l=Object.entries(j.Soundfont);c<l.length;c++){var d=W(l[c],2),h=d[0],v=d[1];if(!v.isLoaded){var y=f.byName[h];if(y){var m=y.program;s[m]=0;for(var g=0;g<o.length;g++){u(v,m,g,o[g])}}}}setTimeout(a,1)},ae=function(e,t,n){if(0===e.indexOf("data:audio")){var r=R(e.split(",")[1]);return P.decodeAudioData(r,t,n)}var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="arraybuffer",o.onsuccess=function(){return P.decodeAudioData(o.response,t,n)},o.send()},ue=function(){return new(window.AudioContext||window.webkitAudioContext)},se={},ce=null,le=function(e,t){ce.send(e,1e3*t)},fe=function(e,t,n,r){ce.send([e,t,n],1e3*r)},de=function(e,t,n){ce.send([176+e,7,t],1e3*n)},pe=function(e,t,n){ce.send([192+e,t],1e3*n)},he=function(e,t,n){ce.send([224+e,t],1e3*n)},ve=function(e,t,n,r){ce.send([144+e,t,n],1e3*r)},ye=function(e,t,n){ce.send([128+e,t,0],1e3*n)},me=function(e,t,n,r){var o=!0,i=!1,a=void 0;try{for(var u,s=t[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var c=u.value;ce.send([144+e,c,n],1e3*r)}}catch(e){i=!0,a=e}finally{try{o||null==s.return||s.return()}finally{if(i)throw a}}},ge=function(e,t,n){var r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var s=a.value;ce.send([128+e,s,0],1e3*n)}}catch(e){o=!0,i=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}},Ae=function(){ce.cancel();for(var e=0;e<16;e++)ce.send([176+e,123,0])},be=function(e){var t=function(t){console.error("Could not connect to web midi! Falling back to WebAudio:",t),se.webaudio_backup_connect&&(se.config.api="webaudio",se.webaudio_backup_connect(e))};navigator.requestMIDIAccess().then(function(n){var r=n.outputs;void 0===(ce="function"==typeof r?r()[0]:r[0])?t("No outputs defined"):e.onsuccess&&e.onsuccess()},t)};function qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var we=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.str=t,this.position=0}var t,n,r;return t=e,(n=[{key:"read",value:function(e){var t=this.str.substr(this.position,e);return this.position+=e,t}},{key:"readInt32",value:function(){var e=(this.str.charCodeAt(this.position)<<24)+(this.str.charCodeAt(this.position+1)<<16)+(this.str.charCodeAt(this.position+2)<<8)+this.str.charCodeAt(this.position+3);return this.position+=4,e}},{key:"readInt16",value:function(){var e=(this.str.charCodeAt(this.position)<<8)+this.str.charCodeAt(this.position+1);return this.position+=2,e}},{key:"readInt8",value:function(e){var t=this.str.charCodeAt(this.position);return e&&t>127&&(t-=256),this.position+=1,t}},{key:"eof",value:function(){return this.position>=this.str.length}},{key:"readVarInt",value:function(){for(var e=0;;){var t=this.readInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}}}])&&qe(t.prototype,n),r&&qe(t,r),e}();function Se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Fe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.stream=new we(t),this.lastEventTypeByte=void 0}var t,n,r;return t=e,(n=[{key:"readChunk",value:function(e){var t=e.read(4),n=e.readInt32();return{id:t,length:n,data:e.read(n)}}},{key:"readEvent",value:function(e){var t={};t.deltaTime=e.readVarInt();var n=e.readInt8();if(240==(240&n)){if(255!==n){if(240===n){t.type="sysEx";var r=e.readVarInt();return t.data=e.read(r),t}if(247===n){t.type="dividedSysEx";var o=e.readVarInt();return t.data=e.read(o),t}throw"Unrecognised MIDI event type byte: "+n}t.type="meta";var i=e.readInt8(),a=e.readVarInt();switch(i){case 0:if(t.subtype="sequenceNumber",2!==a)throw"Expected length for sequenceNumber event is 2, got "+a;return t.number=e.readInt16(),t;case 1:return t.subtype="text",t.text=e.read(a),t;case 2:return t.subtype="copyrightNotice",t.text=e.read(a),t;case 3:return t.subtype="trackName",t.text=e.read(a),t;case 4:return t.subtype="instrumentName",t.text=e.read(a),t;case 5:return t.subtype="lyrics",t.text=e.read(a),t;case 6:return t.subtype="marker",t.text=e.read(a),t;case 7:return t.subtype="cuePoint",t.text=e.read(a),t;case 32:if(t.subtype="midiChannelPrefix",1!==a)throw"Expected length for midiChannelPrefix event is 1, got "+a;return t.channel=e.readInt8(),t;case 47:if(t.subtype="endOfTrack",0!==a)throw"Expected length for endOfTrack event is 0, got "+a;return t;case 81:if(t.subtype="setTempo",3!==a)throw"Expected length for setTempo event is 3, got "+a;return t.microsecondsPerBeat=(e.readInt8()<<16)+(e.readInt8()<<8)+e.readInt8(),t;case 84:if(t.subtype="smpteOffset",5!==a)throw"Expected length for smpteOffset event is 5, got "+a;var u=e.readInt8();return t.frameRate={0:24,32:25,64:29,96:30}[96&u],t.hour=31&u,t.min=e.readInt8(),t.sec=e.readInt8(),t.frame=e.readInt8(),t.subframe=e.readInt8(),t;case 88:if(t.subtype="timeSignature",4!==a)throw"Expected length for timeSignature event is 4, got "+a;return t.numerator=e.readInt8(),t.denominator=Math.pow(2,e.readInt8()),t.metronome=e.readInt8(),t.thirtyseconds=e.readInt8(),t;case 89:if(t.subtype="keySignature",2!==a)throw"Expected length for keySignature event is 2, got "+a;return t.key=e.readInt8(!0),t.scale=e.readInt8(),t;case 127:return t.subtype="sequencerSpecific",t.data=e.read(a),t;default:return t.subtype="unknown",t.data=e.read(a),t}}else{var s;0==(128&n)?(s=n,n=this.lastEventTypeByte):(s=e.readInt8(),this.lastEventTypeByte=n);var c=n>>4;switch(t.channel=15&n,t.type="channel",c){case 8:return t.subtype="noteOff",t.noteNumber=s,t.velocity=e.readInt8(),t;case 9:return t.noteNumber=s,t.velocity=e.readInt8(),0===t.velocity?t.subtype="noteOff":t.subtype="noteOn",t;case 10:return t.subtype="noteAftertouch",t.noteNumber=s,t.amount=e.readInt8(),t;case 11:return t.subtype="controller",t.controllerType=s,t.value=e.readInt8(),t;case 12:return t.subtype="programChange",t.programNumber=s,t;case 13:return t.subtype="channelAftertouch",t.amount=s,t;case 14:return t.subtype="pitchBend",t.value=s+(e.readInt8()<<7),t;default:throw"Unrecognised MIDI event type: "+c}}}},{key:"parseAndReturn",value:function(){var e=this.stream,t=this.readChunk(e);if("MThd"!==t.id||6!==t.length)throw"Bad .mid file - header not found";var n=new we(t.data),r=n.readInt16(),o=n.readInt16(),i=n.readInt16();if(32768&i)throw"Expressing time division in SMTPE frames is not supported yet";for(var a={formatType:r,trackCount:o,ticksPerBeat:i},u=[],s=0;s<a.trackCount;s++){u[s]=[];var c=this.readChunk(e);if("MTrk"!==c.id)throw"Unexpected chunk - expected MTrk, got "+c.id;for(var l=new we(c.data);!l.eof();){var f=this.readEvent(l);u[s].push(f)}}return{header:a,tracks:u}}}])&&Se(t.prototype,n),r&&Se(t,r),e}();function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Te(e){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var xe=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.midiFile=t,this.timeWarp=n,this.eventProcessor=r,this.trackStates=[],this.beatsPerMinute=o||120,this.bpmOverride=!!o,this.ticksPerBeat=t.header.ticksPerBeat;for(var i=0;i<t.tracks.length;i++)this.trackStates[i]={nextEventIndex:0,ticksToNextEvent:t.tracks[i].length?t.tracks[i][0].deltaTime:null};this.temporal=[],this.processEvents()}var t,n,r;return t=e,(n=[{key:"getNextEvent",value:function(){for(var e=null,t=null,n=null,r=0;r<this.trackStates.length;r++)null!=this.trackStates[r].ticksToNextEvent&&(null==e||this.trackStates[r].ticksToNextEvent<e)&&(e=this.trackStates[r].ticksToNextEvent,t=r,n=this.trackStates[r].nextEventIndex);if(null!=t){var o=this.midiFile.tracks[t][n];this.midiFile.tracks[t][n+1]?this.trackStates[t].ticksToNextEvent+=this.midiFile.tracks[t][n+1].deltaTime:this.trackStates[t].ticksToNextEvent=null,this.trackStates[t].nextEventIndex+=1;for(var i=0;i<this.trackStates.length;i++)null!=this.trackStates[i].ticksToNextEvent&&(this.trackStates[i].ticksToNextEvent-=e);return{ticksToEvent:e,event:o,track:t}}return null}},{key:"processEvents",value:function(){for(var e=this.getNextEvent();e;){this.bpmOverride||"meta"!==e.event.type||"setTempo"!==e.event.subtype||(this.beatsPerMinute=6e7/e.event.microsecondsPerBeat);var t=0;e.ticksToEvent>0&&(t=e.ticksToEvent/this.ticksPerBeat/(this.beatsPerMinute/60));var n=1e3*t*this.timeWarp||0;this.temporal.push([e,n]),e=this.getNextEvent()}}},{key:"getData",value:function(){return function e(t){if("object"!=Te(t))return t;if(null==t)return t;var n="number"==typeof t.length?[]:{};for(var r in t)n[r]=e(t[r]);return n}(this.temporal)}}])&&ke(t.prototype,n),r&&ke(t,r),e}();function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ee=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.plugin=t,this.currentTime=0,this.endTime=0,this.restart=0,this.playing=!1,this.timeWarp=1,this.startDelay=0,this.BPM=120,this.eventQueue=[],this.queuedTime=0,this.startTime=0,this.noteRegistrar={},this.onMidiEvent=void 0,this.frame=void 0,this.__now=void 0}var t,n,r;return t=e,(n=[{key:"start",value:function(e){this.currentTime<-1&&(this.currentTime=-1),this.startAudio(this.currentTime,null,e)}},{key:"resume",value:function(e){return this.start(e)}},{key:"pause",value:function(){var e=this.restart;this.stopAudio(),this.restart=e}},{key:"stop",value:function(){this.stopAudio(),this.restart=0,this.currentTime=0}},{key:"addListener",value:function(e){this.onMidiEvent=e}},{key:"removeListener",value:function(){this.onMidiEvent=void 0}},{key:"clearAnimation",value:function(){this.animationFrameId&&cancelAnimationFrame(mthis.animationFrameId)}},{key:"setAnimation",value:function(e){var t=this,n=0,r=0,o=0;this.clearAnimation(),this.frame=function(){if(t.animationFrameId=requestAnimationFrame(t.frame),0!==t.endTime){t.playing?(n=o===t.currentTime?r-Date.now():0,n=0===t.currentTime?0:t.currentTime-n,o!==t.currentTime&&(r=Date.now(),o=t.currentTime)):n=t.currentTime;var i=t.endTime,a=n/1e3,u=a/60,s=60*u+(a-60*u),c=i/1e3;c-s<-1||e({now:s,end:c,events:t.noteRegistrar})}},requestAnimationFrame(this.frame)}},{key:"loadMidiFile",value:function(e,t,n){try{this.replayer=new xe((r=this.currentData,new Fe(r).parseAndReturn()),this.timeWarp,null,this.BPM),this.data=this.replayer.getData(),this.endTime=this.getLength(),this.loadPlugin({onsuccess:e,onprogress:t,onerror:n})}catch(e){n&&n(e)}var r}},{key:"loadPlugin",value:function(){}},{key:"loadFile",value:function(e,t,n,r){var o=this;if(this.stop(),-1!==e.indexOf("base64,"))this.currentData=atob(e.split(",")[1]),this.loadMidiFile(t,n,r);else{var i=new XMLHttpRequest;i.open("GET",e),i.overrideMimeType("text/plain; charset=x-user-defined"),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){for(var e=i.responseText||"",a=[],u=e.length,s=String.fromCharCode,c=0;c<u;c++)a[c]=s(255&e.charCodeAt(c));o.currentData=a.join(""),o.loadMidiFile(t,n,r)}else r&&r("Unable to load MIDI file")},i.send()}}},{key:"getFileInstruments",value:function(){for(var e={},t={},n=0;n<midi.data.length;n++){var r=midi.data[n][0].event;if("channel"===r.type){var o=r.channel;switch(r.subtype){case"controller":break;case"programChange":t[o]=r.programNumber;break;case"noteOn":var i=t[o];e[f.byId[isFinite(i)?i:o].id]=!0}}}for(var a=[],u=0,s=Object.keys(e);u<s.length;u++){var c=s[u];a.push(c)}return a}},{key:"scheduleTracking",value:function(e,t,n,r,o,i,a){var u=this;return setTimeout(function(){var r={channel:e,note:t,now:n,end:u.endTime,message:o,velocity:i};128===o?delete u.noteRegistrar[t]:u.noteRegistrar[t]=r,u.onMidiEvent&&u.onMidiEvent(r),u.currentTime=n,u.eventQueue.shift(),u.eventQueue.length<1e3?u.startAudio(u.queuedTime,!0):u.currentTime===u.queuedTime&&u.queuedTime<u.endTime&&u.startAudio(u.queuedTime,!0)},n-r)}},{key:"getContext",value:function(){return"webaudio"===MIDI.api?MIDI.WebAudio.getContext():(this.ctx={currentTime:0},this.ctx)}},{key:"getLength",value:function(){for(var e=this.data,t=e.length,n=.5,r=0;r<t;r++)n+=e[r][1];return n}},{key:"getNow",value:function(){return window.performance&&window.performance.now?window.performance.now():Date.now()}},{key:"startAudio",value:function(e,t,n){if(this.replayer){var r;t||(void 0===e&&(e=this.restart),this.playing&&this.stopAudio(),this.playing=!0,this.data=this.replayer.getData(),this.endTime=this.getLength());var o=0,i=0,a=this.data,u=this.getContext(),s=a.length;this.queuedTime=.5;this.eventQueue[0]&&this.eventQueue[0].interval;var c=e-this.currentTime;if("webaudio"!==MIDI.api){var l=this.getNow();this.__now=this.__now||l,u.currentTime=(l-this.__now)/1e3}this.startTime=u.currentTime;for(var f=0;f<s&&i<100;f++){var p=a[f];if((this.queuedTime+=p[1])<=e)o=this.queuedTime;else{e=this.queuedTime-o;var h=p[0].event;if("channel"===h.type){var v=h.channel,y=d[v],m=u.currentTime+(e+c+this.startDelay)/1e3,g=this.queuedTime-o+this.startDelay;switch(h.subtype){case"controller":MIDI.setController(v,h.controllerType,h.value,m);break;case"programChange":MIDI.programChange(v,h.programNumber,m);break;case"pitchBend":MIDI.pitchBend(v,h.value,m);break;case"noteOn":if(y.mute)break;r=h.noteNumber-(this.MIDIOffset||0),this.eventQueue.push({event:h,time:g,source:MIDI.noteOn(v,h.noteNumber,h.velocity,m),interval:this.scheduleTracking(v,r,this.queuedTime+this.startDelay,o-c,144,h.velocity)}),i++;break;case"noteOff":if(y.mute)break;r=h.noteNumber-(this.MIDIOffset||0),this.eventQueue.push({event:h,time:g,source:MIDI.noteOff(v,h.noteNumber,m),interval:this.scheduleTracking(v,r,this.queuedTime,o-c,128,0)})}}}}n&&n(this.eventQueue)}}},{key:"stopAudio",value:function(){var e=this.getContext();for(this.playing=!1,this.restart+=1e3*(e.currentTime-this.startTime);this.eventQueue.length;){var t=this.eventQueue.pop();window.clearInterval(t.interval),t.source&&("number"==typeof t.source?window.clearTimeout(t.source):t.source.disconnect(0))}for(var n in this.noteRegistrar){var r=this.noteRegistrar[n];144===this.noteRegistrar[n].message&&this.onMidiEvent&&this.onMidiEvent({channel:r.channel,note:r.note,now:r.now,end:r.end,message:128,velocity:r.velocity})}this.noteRegistrar={}}}])&&Ce(t.prototype,n),r&&Ce(t,r),e}(),Be={"Isaac Newton (1704)":{format:"HSL",ref:"Gerstner, p.167",english:["red",null,"orange",null,"yellow","green",null,"blue",null,"indigo",null,"violet"],0:[0,96,51],1:[0,0,0],2:[29,94,52],3:[0,0,0],4:[60,90,60],5:[135,76,32],6:[0,0,0],7:[248,82,28],8:[0,0,0],9:[302,88,26],10:[0,0,0],11:[325,84,46]},"Louis Bertrand Castel (1734)":{format:"HSL",ref:"Peacock, p.400",english:["blue","blue-green","green","olive green","yellow","yellow-orange","orange","red","crimson","violet","agate","indigo"],0:[248,82,28],1:[172,68,34],2:[135,76,32],3:[79,59,36],4:[60,90,60],5:[49,90,60],6:[29,94,52],7:[360,96,51],8:[1,89,33],9:[325,84,46],10:[273,80,27],11:[302,88,26]},"George Field (1816)":{format:"HSL",ref:"Klein, p.69",english:["blue",null,"purple",null,"red","orange",null,"yellow",null,"yellow green",null,"green"],0:[248,82,28],1:[0,0,0],2:[302,88,26],3:[0,0,0],4:[360,96,51],5:[29,94,52],6:[0,0,0],7:[60,90,60],8:[0,0,0],9:[79,59,36],10:[0,0,0],11:[135,76,32]},"D. D. Jameson (1844)":{format:"HSL",ref:"Jameson, p.12",english:["red","red-orange","orange","orange-yellow","yellow","green","green-blue","blue","blue-purple","purple","purple-violet","violet"],0:[360,96,51],1:[14,91,51],2:[29,94,52],3:[49,90,60],4:[60,90,60],5:[135,76,32],6:[172,68,34],7:[248,82,28],8:[273,80,27],9:[302,88,26],10:[313,78,37],11:[325,84,46]},"Theodor Seemann (1881)":{format:"HSL",ref:"Klein, p.86",english:["carmine","scarlet","orange","yellow-orange","yellow","green","green blue","blue","indigo","violet","brown","black"],0:[0,58,26],1:[360,96,51],2:[29,94,52],3:[49,90,60],4:[60,90,60],5:[135,76,32],6:[172,68,34],7:[248,82,28],8:[302,88,26],9:[325,84,46],10:[0,58,26],11:[0,0,3]},"A. Wallace Rimington (1893)":{format:"HSL",ref:"Peacock, p.402",english:["deep red","crimson","orange-crimson","orange","yellow","yellow-green","green","blueish green","blue-green","indigo","deep blue","violet"],0:[360,96,51],1:[1,89,33],2:[14,91,51],3:[29,94,52],4:[60,90,60],5:[79,59,36],6:[135,76,32],7:[163,62,40],8:[172,68,34],9:[302,88,26],10:[248,82,28],11:[325,84,46]},"Bainbridge Bishop (1893)":{format:"HSL",ref:"Bishop, p.11",english:["red","orange-red or scarlet","orange","gold or yellow-orange","yellow or green-gold","yellow-green","green","greenish-blue or aquamarine","blue","indigo or violet-blue","violet","violet-red","red"],0:[360,96,51],1:[1,89,33],2:[29,94,52],3:[50,93,52],4:[60,90,60],5:[73,73,55],6:[135,76,32],7:[163,62,40],8:[302,88,26],9:[325,84,46],10:[343,79,47],11:[360,96,51]},"H. von Helmholtz (1910)":{format:"HSL",ref:"Helmholtz, p.22",english:["yellow","green","greenish blue","cayan-blue","indigo blue","violet","end of red","red","red","red","red orange","orange"],0:[60,90,60],1:[135,76,32],2:[172,68,34],3:[211,70,37],4:[302,88,26],5:[325,84,46],6:[330,84,34],7:[360,96,51],8:[10,91,43],9:[10,91,43],10:[8,93,51],11:[28,89,50]},"Alexander Scriabin (1911)":{format:"HSL",ref:"Jones, p.104",english:["red","violet","yellow","steely with the glint of metal","pearly blue the shimmer of moonshine","dark red","bright blue","rosy orange","purple","green","steely with a glint of metal","pearly blue the shimmer of moonshine"],0:[360,96,51],1:[325,84,46],2:[60,90,60],3:[245,21,43],4:[211,70,37],5:[1,89,33],6:[248,82,28],7:[29,94,52],8:[302,88,26],9:[135,76,32],10:[245,21,43],11:[211,70,37]},"Adrian Bernard Klein (1930)":{format:"HSL",ref:"Klein, p.209",english:["dark red","red","red orange","orange","yellow","yellow green","green","blue-green","blue","blue violet","violet","dark violet"],0:[0,91,40],1:[360,96,51],2:[14,91,51],3:[29,94,52],4:[60,90,60],5:[73,73,55],6:[135,76,32],7:[172,68,34],8:[248,82,28],9:[292,70,31],10:[325,84,46],11:[330,84,34]},"August Aeppli (1940)":{format:"HSL",ref:"Gerstner, p.169",english:["red",null,"orange",null,"yellow",null,"green","blue-green",null,"ultramarine blue","violet","purple"],0:[0,96,51],1:[0,0,0],2:[29,94,52],3:[0,0,0],4:[60,90,60],5:[0,0,0],6:[135,76,32],7:[172,68,34],8:[0,0,0],9:[211,70,37],10:[273,80,27],11:[302,88,26]},"I. J. Belmont (1944)":{ref:"Belmont, p.226",english:["red","red-orange","orange","yellow-orange","yellow","yellow-green","green","blue-green","blue","blue-violet","violet","red-violet"],0:[360,96,51],1:[14,91,51],2:[29,94,52],3:[50,93,52],4:[60,90,60],5:[73,73,55],6:[135,76,32],7:[172,68,34],8:[248,82,28],9:[313,78,37],10:[325,84,46],11:[338,85,37]},"Steve Zieverink (2004)":{format:"HSL",ref:"Cincinnati Contemporary Art Center",english:["yellow-green","green","blue-green","blue","indigo","violet","ultra violet","infra red","red","orange","yellow-white","yellow"],0:[73,73,55],1:[135,76,32],2:[172,68,34],3:[248,82,28],4:[302,88,26],5:[325,84,46],6:[326,79,24],7:[1,89,33],8:[360,96,51],9:[29,94,52],10:[62,78,74],11:[60,90,60]},"Circle of Fifths (Johnston 2003)":{format:"RGB",ref:"Joseph Johnston",english:["yellow","blue","orange","teal","red","green","purple","light orange","light blue","dark orange","dark green","violet"],0:[255,255,0],1:[50,0,255],2:[255,150,0],3:[0,210,180],4:[255,0,0],5:[130,255,0],6:[150,0,200],7:[255,195,0],8:[30,130,255],9:[255,100,0],10:[0,200,0],11:[225,0,225]},"Circle of Fifths (Wheatman 2002)":{format:"HEX",ref:"Stuart Wheatman",english:[],data:["#122400","#2E002E","#002914","#470000","#002142","#2E2E00","#290052","#003D00","#520029","#003D3D","#522900","#000080","#244700","#570057","#004D26","#7A0000","#003B75","#4C4D00","#47008F","#006100","#850042","#005C5C","#804000","#0000C7","#366B00","#80007F","#00753B","#B80000","#0057AD","#6B6B00","#6600CC","#008A00","#B8005C","#007F80","#B35900","#2424FF","#478F00","#AD00AD","#00994D","#F00000","#0073E6","#8F8F00","#8A14FF","#00AD00","#EB0075","#00A3A3","#E07000","#6B6BFF","#5CB800","#DB00DB","#00C261","#FF5757","#3399FF","#ADAD00","#B56BFF","#00D600","#FF57AB","#00C7C7","#FF9124","#9999FF","#6EDB00","#FF29FF","#00E070","#FF9999","#7ABDFF","#D1D100","#D1A3FF","#00FA00","#FFA3D1","#00E5E6","#FFC285","#C2C2FF","#80FF00","#FFA8FF","#00E070","#FFCCCC","#C2E0FF","#F0F000","#EBD6FF","#ADFFAD","#FFD6EB","#8AFFFF","#FFEBD6","#EBEBFF","#E0FFC2","#FFEBFF","#E5FFF2","#FFF5F5"]}},Ie=function(e){for(var t,n,r,o,i,a={},u=Be,s=u[e]||u["D. D. Jameson (1844)"],c=s[3],l=0;l<=88;l++)if(s.data)a[l]={hsl:s.data[l],hex:s.data[l]};else{var f=s[(l+9)%12];switch(s.format){case"RGB":t=(f=Color.Space(f,"RGB>HSL")).H>>0,n=f.S>>0,r=f.L>>0;break;case"HSL":t=f[0],n=f[1],r=f[2]}t===n&&n===r&&(o=c,i=s[(l+10)%12],f=[.5*o[0]+.5*i[0]+.5>>0,.5*o[1]+.5*i[1]+.5>>0,.5*o[2]+.5*i[2]+.5>>0]),a[l]={hsl:"hsla("+t+","+n+"%,"+r+"%, 1)",hex:Color.Space({H:t,S:n,L:r},"HSL>RGB>HEX>W3")},c=f}return a};function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Me(e,t){return!t||"object"!==Ue(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function De(e){return(De=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ke(e,t){return(Ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ue(e){return(Ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"Soundfont",function(){return Je}),n.d(t,"audio_contexts",function(){return Re}),n.d(t,"config",function(){return We}),n.d(t,"loadPlugin",function(){return Pe}),n.d(t,"loadProgram",function(){return je}),n.d(t,"requestQueue",function(){return Ve}),n.d(t,"sendRequest",function(){return Ze}),n.d(t,"playChannel",function(){return Le}),n.d(t,"stopChannel",function(){return Ye}),n.d(t,"send",function(){return _e}),n.d(t,"setController",function(){return He}),n.d(t,"setVolume",function(){return Qe}),n.d(t,"programChange",function(){return Xe}),n.d(t,"pitchBend",function(){return ze}),n.d(t,"noteOn",function(){return $e}),n.d(t,"noteOff",function(){return et}),n.d(t,"chordOn",function(){return tt}),n.d(t,"chordOff",function(){return nt}),n.d(t,"stopAllNotes",function(){return rt}),n.d(t,"setEffects",function(){return ot}),n.d(t,"getContext",function(){return it}),n.d(t,"setContext",function(){return at}),n.d(t,"Player",function(){return ut}),n.d(t,"GM",function(){return f}),n.d(t,"noteToKey",function(){return h}),n.d(t,"keyToNote",function(){return p}),n.d(t,"Synesthesia",function(){return a});var Je={},Re={AudioTag:r,WebAudio:o,WebMIDI:i},We={soundfontUrl:"./soundfont/",api:void 0,audioFormat:void 0,supports:{},connected_plugin:void 0},Pe=function(e){"function"==typeof e&&(e={onsuccess:e}),e.onprogress=e.onprogress||void 0,e.api=e.api||"",e.targetFormat=e.targetFormat||"",e.instrument=e.instrument||"acoustic_grand_piano",e.instruments=e.instruments||void 0,e.apiPrecedence=e.apiPrecedence||["webaudio","webmidi","audiotag"],We.soundfontUrl=e.soundfontUrl||We.soundfontUrl,function(e){if("undefined"!=typeof navigator&&navigator.requestMIDIAccess)if(Function.prototype.toString.call(navigator.requestMIDIAccess).indexOf("[native code]"))u.webmidi=!0;else if("undefined"!=typeof navigator&&void 0!==navigator.plugins)for(var t=0,n=Array.from(navigator.plugins);t<n.length;t++)n[t].name.indexOf("Jazz-Plugin")>=0&&(u.webmidi=!0);if("undefined"==typeof Audio)return e({});u.audiotag=!0,(window.AudioContext||window.webkitAudioContext)&&(u.webaudio=!0);var r=new Audio;if(void 0===r.canPlayType)return e(u);var o=r.canPlayType('audio/ogg; codecs="vorbis"');o="probably"===o||"maybe"===o;var i=r.canPlayType("audio/mpeg");if(i="probably"===i||"maybe"===i,o||i){o&&c("audio/ogg;base64,T2dnUwACAAAAAAAAAADqnjMlAAAAAOyyzPIBHgF2b3JiaXMAAAAAAUAfAABAHwAAQB8AAEAfAACZAU9nZ1MAAAAAAAAAAAAA6p4zJQEAAAANJGeqCj3//////////5ADdm9yYmlzLQAAAFhpcGguT3JnIGxpYlZvcmJpcyBJIDIwMTAxMTAxIChTY2hhdWZlbnVnZ2V0KQAAAAABBXZvcmJpcw9CQ1YBAAABAAxSFCElGVNKYwiVUlIpBR1jUFtHHWPUOUYhZBBTiEkZpXtPKpVYSsgRUlgpRR1TTFNJlVKWKUUdYxRTSCFT1jFloXMUS4ZJCSVsTa50FkvomWOWMUYdY85aSp1j1jFFHWNSUkmhcxg6ZiVkFDpGxehifDA6laJCKL7H3lLpLYWKW4q91xpT6y2EGEtpwQhhc+211dxKasUYY4wxxsXiUyiC0JBVAAABAABABAFCQ1YBAAoAAMJQDEVRgNCQVQBABgCAABRFcRTHcRxHkiTLAkJDVgEAQAAAAgAAKI7hKJIjSZJkWZZlWZameZaouaov+64u667t6roOhIasBACAAAAYRqF1TCqDEEPKQ4QUY9AzoxBDDEzGHGNONKQMMogzxZAyiFssLqgQBKEhKwKAKAAAwBjEGGIMOeekZFIi55iUTkoDnaPUUcoolRRLjBmlEluJMYLOUeooZZRCjKXFjFKJscRUAABAgAMAQICFUGjIigAgCgCAMAYphZRCjCnmFHOIMeUcgwwxxiBkzinoGJNOSuWck85JiRhjzjEHlXNOSuekctBJyaQTAAAQ4AAAEGAhFBqyIgCIEwAwSJKmWZomipamiaJniqrqiaKqWp5nmp5pqqpnmqpqqqrrmqrqypbnmaZnmqrqmaaqiqbquqaquq6nqrZsuqoum65q267s+rZru77uqapsm6or66bqyrrqyrbuurbtS56nqqKquq5nqq6ruq5uq65r25pqyq6purJtuq4tu7Js664s67pmqq5suqotm64s667s2rYqy7ovuq5uq7Ks+6os+75s67ru2rrwi65r66os674qy74x27bwy7ouHJMnqqqnqq7rmarrqq5r26rr2rqmmq5suq4tm6or26os67Yry7aumaosm64r26bryrIqy77vyrJui67r66Ys67oqy8Lu6roxzLat+6Lr6roqy7qvyrKuu7ru+7JuC7umqrpuyrKvm7Ks+7auC8us27oxuq7vq7It/KosC7+u+8Iy6z5jdF1fV21ZGFbZ9n3d95Vj1nVhWW1b+V1bZ7y+bgy7bvzKrQvLstq2scy6rSyvrxvDLux8W/iVmqratum6um7Ksq/Lui60dd1XRtf1fdW2fV+VZd+3hV9pG8OwjK6r+6os68Jry8ov67qw7MIvLKttK7+r68ow27qw3L6wLL/uC8uq277v6rrStXVluX2fsSu38QsAABhwAAAIMKEMFBqyIgCIEwBAEHIOKQahYgpCCKGkEEIqFWNSMuakZM5JKaWUFEpJrWJMSuaclMwxKaGUlkopqYRSWiqlxBRKaS2l1mJKqcVQSmulpNZKSa2llGJMrcUYMSYlc05K5pyUklJrJZXWMucoZQ5K6iCklEoqraTUYuacpA46Kx2E1EoqMZWUYgupxFZKaq2kFGMrMdXUWo4hpRhLSrGVlFptMdXWWqs1YkxK5pyUzDkqJaXWSiqtZc5J6iC01DkoqaTUYiopxco5SR2ElDLIqJSUWiupxBJSia20FGMpqcXUYq4pxRZDSS2WlFosqcTWYoy1tVRTJ6XFklKMJZUYW6y5ttZqDKXEVkqLsaSUW2sx1xZjjqGkFksrsZWUWmy15dhayzW1VGNKrdYWY40x5ZRrrT2n1mJNMdXaWqy51ZZbzLXnTkprpZQWS0oxttZijTHmHEppraQUWykpxtZara3FXEMpsZXSWiypxNhirLXFVmNqrcYWW62ltVprrb3GVlsurdXcYqw9tZRrrLXmWFNtBQAADDgAAASYUAYKDVkJAEQBAADGMMYYhEYpx5yT0ijlnHNSKucghJBS5hyEEFLKnINQSkuZcxBKSSmUklJqrYVSUmqttQIAAAocAAACbNCUWByg0JCVAEAqAIDBcTRNFFXVdX1fsSxRVFXXlW3jVyxNFFVVdm1b+DVRVFXXtW3bFn5NFFVVdmXZtoWiqrqybduybgvDqKqua9uybeuorqvbuq3bui9UXVmWbVu3dR3XtnXd9nVd+Bmzbeu2buu+8CMMR9/4IeTj+3RCCAAAT3AAACqwYXWEk6KxwEJDVgIAGQAAgDFKGYUYM0gxphhjTDHGmAAAgAEHAIAAE8pAoSErAoAoAADAOeecc84555xzzjnnnHPOOeecc44xxhhjjDHGGGOMMcYYY4wxxhhjjDHGGGOMMcYYY0wAwE6EA8BOhIVQaMhKACAcAABACCEpKaWUUkoRU85BSSmllFKqFIOMSkoppZRSpBR1lFJKKaWUIqWgpJJSSimllElJKaWUUkoppYw6SimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaWUUkoppZRSSimllFJKKaVUSimllFJKKaWUUkoppRQAYPLgAACVYOMMK0lnhaPBhYasBAByAwAAhRiDEEJpraRUUkolVc5BKCWUlEpKKZWUUqqYgxBKKqmlklJKKbXSQSihlFBKKSWUUkooJYQQSgmhlFRCK6mEUkoHoYQSQimhhFRKKSWUzkEoIYUOQkmllNRCSB10VFIpIZVSSiklpZQ6CKGUklJLLZVSWkqpdBJSKamV1FJqqbWSUgmhpFZKSSWl0lpJJbUSSkklpZRSSymFVFJJJYSSUioltZZaSqm11lJIqZWUUkqppdRSSiWlkEpKqZSSUmollZRSaiGVlEpJKaTUSimlpFRCSamlUlpKLbWUSkmptFRSSaWUlEpJKaVSSksppRJKSqmllFpJKYWSUkoplZJSSyW1VEoKJaWUUkmptJRSSymVklIBAEAHDgAAAUZUWoidZlx5BI4oZJiAAgAAQABAgAkgMEBQMApBgDACAQAAAADAAAAfAABHARAR0ZzBAUKCwgJDg8MDAAAAAAAAAAAAAACAT2dnUwAEAAAAAAAAAADqnjMlAgAAADzQPmcBAQA="),i&&c("audio/mpeg;base64,/+MYxAAAAANIAUAAAASEEB/jwOFM/0MM/90b/+RhST//w4NFwOjf///PZu////9lns5GFDv//l9GlUIEEIAAAgIg8Ir/JGq3/+MYxDsLIj5QMYcoAP0dv9HIjUcH//yYSg+CIbkGP//8w0bLVjUP///3Z0x5QCAv/yLjwtGKTEFNRTMuOTeqqqqqqqqqqqqq/+MYxEkNmdJkUYc4AKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq");var a=(new Date).getTime(),l=window.setInterval(function(){var t=(new Date).getTime();s&&!(t-a>5e3)||(window.clearInterval(l),e(u))},1)}else e(u)}(function(t){var n,r=window.location.hash,o="";if(t[e.api])o=e.api;else if(t[r.substr(1)])o=r.substr(1);else{var i=!0,a=!1,u=void 0;try{for(var s,c=e.apiPrecedence[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var l=s.value;if(t[l]){o=l;break}}}catch(e){a=!0,u=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw u}}}Ne[o]&&(n=e.targetFormat?e.targetFormat:t["audio/ogg"]?"ogg":"mp3",We.api=o,We.audioFormat=n,We.supports=t,je(e))})},je=function(e){var t=e.instruments||e.instrument||"acoustic_grand_piano";"object"!==Ue(t)&&(t=t||0===t?[t]:[]);for(var n=0;n<t.length;n++){var r=t[n];r===r+0&&GM.byId[r]&&(t[n]=GM.byId[r].id)}e.format=We.audioFormat,e.instruments=t,Ne[We.api](e)},Ne={webmidi:function(e){Ge(i,e),be(e)},audiotag:function(e){Ge(r,e),Ve(e,"AudioTag")},webaudio:function(e){Ge(o,e),Ve(e,"WebAudio")}},Ge=function(e,t){We.connected_plugin=e,e.shared_root_info.Soundfont=Je,e.shared_root_info.config=We,e.shared_root_info.webaudio_backup_connect=function(e){return Ne.webaudio(e)}},Ve=function(e,t){var n=e.format,r=e.instruments,o=e.onprogress,i=e.onerror,a=Re[t]||t.WebAudio,u=r.length,s=u,c=function(){(s-=1)||(o&&o("load",1),a.connect(e))},l=!0,f=!1,d=void 0;try{for(var p,h=function(){var e=p.value;if(Je[e])c();else{Ze(e,n,function(t,n){o&&o("load",n/u+(u-s)/u,e)},function(){return c()},i)}},v=r[Symbol.iterator]();!(l=(p=v.next()).done);l=!0)h()}catch(e){f=!0,d=e}finally{try{l||null==v.return||v.return()}finally{if(f)throw d}}},Ze=function(e,t,n,r,o){var i=We.soundfontUrl+e+"-"+t+".js",a=new XMLHttpRequest;a.open("GET",i),a.setRequestHeader("Content-Type","text/plain"),a.onload=function(){if(200===a.status){var e=document.createElement("script");e.language="javascript",e.type="text/javascript",e.text=a.responseText,document.body.appendChild(e),r()}else o()},a.send()},Le=function(){var e;return(e=We.connected_plugin).playChannel.apply(e,arguments)},Ye=function(){var e;return(e=We.connected_plugin).stopChannel.apply(e,arguments)},_e=function(){var e;return(e=We.connected_plugin).send.apply(e,arguments)},He=function(){var e;return(e=We.connected_plugin).setController.apply(e,arguments)},Qe=function(){var e;return(e=We.connected_plugin).setVolume.apply(e,arguments)},Xe=function(){var e;return(e=We.connected_plugin).programChange.apply(e,arguments)},ze=function(){var e;return(e=We.connected_plugin).pitchBend.apply(e,arguments)},$e=function(){var e;return(e=We.connected_plugin).noteOn.apply(e,arguments)},et=function(){var e;return(e=We.connected_plugin).noteOff.apply(e,arguments)},tt=function(){var e;return(e=We.connected_plugin).chordOn.apply(e,arguments)},nt=function(){var e;return(e=We.connected_plugin).chordOff.apply(e,arguments)},rt=function(){var e;return(e=We.connected_plugin).stopAllNotes.apply(e,arguments)},ot=function(){if(We.connected_plugin===o)return We.connected_plugin.setEffects()},it=function(){if(We.connected_plugin===o)return We.connected_plugin.getContext()},at=function(){var e;if(We.connected_plugin===o)return(e=We.connected_plugin).setContext.apply(e,arguments)},ut=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),Me(this,De(t).call(this,We.connected_plugin))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ke(e,t)}(t,Ee),n=t,(r=[{key:"loadPlugin",value:function(){return Pe.apply(void 0,arguments)}}])&&Oe(n.prototype,r),o&&Oe(n,o),t}()}])});
//# sourceMappingURL=midicube.js.map